<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><meta name="viewport" content="width=device-width, initial-scale=0.8"/><title>An Introduction to Redex with Abstracting Abstract Machines (v0.6)</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="autobib.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="index.html" class="tocviewselflink" data-pltdoc="x">An Introduction to Redex with Abstracting Abstract Machines (v0.6)</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="index.html#%28part._.Introduction%29" class="tocviewlink" data-pltdoc="x">Introduction</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="index.html#%28part._.Warmup%29" class="tocviewlink" data-pltdoc="x">Warmup</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="index.html#%28part._.P.C.F%29" class="tocviewlink" data-pltdoc="x">PCF</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="index.html#%28part._.Approximating_interpretation%29" class="tocviewlink" data-pltdoc="x">Approximating interpretation</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="index.html#%28part._.Going_further%29" class="tocviewlink" data-pltdoc="x">Going further</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="index.html#%28part._.Acknowledgments%29" class="tocviewlink" data-pltdoc="x">Acknowledgments</a></td></tr><tr><td align="right"></td><td><a href="index.html#%28part._doc-bibliography%29" class="tocviewlink" data-pltdoc="x">Bibliography</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="index.html#%28part._.Appendix__.Substitution%29" class="tocviewlink" data-pltdoc="x">Appendix:<span class="mywbr"> &nbsp;</span> Substitution</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.An_.Introduction_to_.Redex_with_.Abstracting_.Abstract_.Machines__v0_6_%29" class="tocsubseclink" data-pltdoc="x">An Introduction to Redex with Abstracting Abstract Machines (v0.6)</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Introduction%29" class="tocsubseclink" data-pltdoc="x">Introduction</a></td></tr><tr><td><span class="tocsublinknumber">1.1<tt>&nbsp;</tt></span><a href="#%28part._.What_is_.Redex_%29" class="tocsubseclink" data-pltdoc="x">What is Redex?</a></td></tr><tr><td><span class="tocsublinknumber">1.2<tt>&nbsp;</tt></span><a href="#%28part._.What_is_.Abstracting_.Abstract_.Machines_%29" class="tocsubseclink" data-pltdoc="x">What is Abstracting Abstract Machines?</a></td></tr><tr><td><span class="tocsublinknumber">1.3<tt>&nbsp;</tt></span><a href="#%28part._.Prerequisites%29" class="tocsubseclink" data-pltdoc="x">Prerequisites</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Warmup%29" class="tocsubseclink" data-pltdoc="x">Warmup</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.P.C.F%29" class="tocsubseclink" data-pltdoc="x">PCF</a></td></tr><tr><td><span class="tocsublinknumber">3.1<tt>&nbsp;</tt></span><a href="#%28part._.Typing_judgement%29" class="tocsubseclink" data-pltdoc="x">Typing judgement</a></td></tr><tr><td><span class="tocsublinknumber">3.2<tt>&nbsp;</tt></span><a href="#%28part._.The_calculus_of_.P.C.F%29" class="tocsubseclink" data-pltdoc="x">The calculus of PCF</a></td></tr><tr><td><span class="tocsublinknumber">3.3<tt>&nbsp;</tt></span><a href="#%28part._.Call-by-value_and_call-by-name__.Strategies__contexts__and_axioms%29" class="tocsubseclink" data-pltdoc="x">Call-<wbr></wbr>by-<wbr></wbr>value and call-<wbr></wbr>by-<wbr></wbr>name:<span class="mywbr"> &nbsp;</span> Strategies, contexts, and axioms</a></td></tr><tr><td><span class="tocsublinknumber">3.4<tt>&nbsp;</tt></span><a href="#%28part._.Evaluation%29" class="tocsubseclink" data-pltdoc="x">Evaluation</a></td></tr><tr><td><span class="tocsublinknumber">3.5<tt>&nbsp;</tt></span><a href="#%28part._.A_brief_aside_on_the_caveats_of_language_extensions%29" class="tocsubseclink" data-pltdoc="x">A brief aside on the caveats of language extensions</a></td></tr><tr><td><span class="tocsublinknumber">3.6<tt>&nbsp;</tt></span><a href="#%28part._.Explicit_substitutions%29" class="tocsubseclink" data-pltdoc="x">Explicit substitutions</a></td></tr><tr><td><span class="tocsublinknumber">3.7<tt>&nbsp;</tt></span><a href="#%28part._.Eval_.Continue_.Apply_machine%29" class="tocsubseclink" data-pltdoc="x">Eval/<span class="mywbr"> &nbsp;</span>Continue/<span class="mywbr"> &nbsp;</span>Apply machine</a></td></tr><tr><td><span class="tocsublinknumber">3.8<tt>&nbsp;</tt></span><a href="#%28part._.Heap-allocated_bindings%29" class="tocsubseclink" data-pltdoc="x">Heap-<wbr></wbr>allocated bindings</a></td></tr><tr><td><span class="tocsublinknumber">3.9<tt>&nbsp;</tt></span><a href="#%28part._.Abstracting_over_alloc%29" class="tocsubseclink" data-pltdoc="x">Abstracting over <span class="RktSym">alloc</span></a></td></tr><tr><td><span class="tocsublinknumber">3.10<tt>&nbsp;</tt></span><a href="#%28part._.Heap-allocated_continuations%29" class="tocsubseclink" data-pltdoc="x">Heap-<wbr></wbr>allocated continuations</a></td></tr><tr><td><span class="tocsublinknumber">3.11<tt>&nbsp;</tt></span><a href="#%28part._.A_look_back__a_look_forward%29" class="tocsubseclink" data-pltdoc="x">A look back; a look forward</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.Approximating_interpretation%29" class="tocsubseclink" data-pltdoc="x">Approximating interpretation</a></td></tr><tr><td><span class="tocsublinknumber">4.1<tt>&nbsp;</tt></span><a href="#%28part._.Abstracting_over__%29" class="tocsubseclink" data-pltdoc="x">Abstracting over <span class="RktSym">&#931;</span></a></td></tr><tr><td><span class="tocsublinknumber">4.2<tt>&nbsp;</tt></span><a href="#%28part._.Set-based_heap%29" class="tocsubseclink" data-pltdoc="x">Set-<wbr></wbr>based heap</a></td></tr><tr><td><span class="tocsublinknumber">4.3<tt>&nbsp;</tt></span><a href="#%28part._.Make_it_finite%29" class="tocsubseclink" data-pltdoc="x">Make it finite</a></td></tr><tr><td><span class="tocsublinknumber">4.4<tt>&nbsp;</tt></span><a href="#%28part._.Soundness%29" class="tocsubseclink" data-pltdoc="x">Soundness</a></td></tr><tr><td><span class="tocsublinknumber">4.5<tt>&nbsp;</tt></span><a href="#%28part._.Discovering_properties%29" class="tocsubseclink" data-pltdoc="x">Discovering properties</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Going_further%29" class="tocsubseclink" data-pltdoc="x">Going further</a></td></tr><tr><td><span class="tocsublinknumber">5.1<tt>&nbsp;</tt></span><a href="#%28part._.Going_further_with_.Redex%29" class="tocsubseclink" data-pltdoc="x">Going further with Redex</a></td></tr><tr><td><span class="tocsublinknumber">5.2<tt>&nbsp;</tt></span><a href="#%28part._.Going_futher_with_.A.A.M%29" class="tocsubseclink" data-pltdoc="x">Going futher with AAM</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.Acknowledgments%29" class="tocsubseclink" data-pltdoc="x">Acknowledgments</a></td></tr><tr><td><span class="tocsublinknumber"></span><a href="#%28part._doc-bibliography%29" class="tocsubseclink" data-pltdoc="x">Bibliography</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.Appendix__.Substitution%29" class="tocsubseclink" data-pltdoc="x">Appendix:<span class="mywbr"> &nbsp;</span> Substitution</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">7.9</span></div><h2><a name="(part._.An_.Introduction_to_.Redex_with_.Abstracting_.Abstract_.Machines__v0_6_)"></a>An Introduction to Redex with Abstracting Abstract Machines (v0.6)</h2><p><a href="https://github.com/dvanhorn/redex-aam-tutorial/"><img src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" style="position: absolute; top: 0; right: 0; border: 0;"/></a></p><p>David Van Horn &lt;<a href="mailto:dvanhorn@cs.umd.edu">dvanhorn@cs.umd.edu</a>&gt;</p><p>Last updated: Friday, November 27th, 2020</p><h3>1<tt>&nbsp;</tt><a name="(part._.Introduction)"></a>Introduction</h3><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>This is a &ldquo;living&rdquo; artifact: please submit bug reports
and pull requests whenever you spot problems in this document.
<a href="https://github.com/dvanhorn/redex-aam-tutorial/"><span class="url">https://github.com/dvanhorn/redex-aam-tutorial/</span></a></p></blockquote></blockquote></blockquote><p>This article provides a brief introduction to the Redex programming
language for semantic modelling.  It does so by developing several
semantic models of a simple programming language and then showing how
to construct a program analyzer for this language using the
&ldquo;Abstracting Abstract Machines&rdquo; method<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Abstracting._.Abstract._.Machines.In._.Proc..._.The._15th._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292010%29" class="AutobibLink" data-pltdoc="x">Van Horn and Might</a> <a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Abstracting._.Abstract._.Machines.In._.Proc..._.The._15th._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292010%29" class="AutobibLink" data-pltdoc="x">2010</a>)</span>.</p><p>So this tutorial aims to accomplish two goals:</p><ul><li><p>(1) to introduce semantic engineers (programming language
researchers, language designers and implementors, analysis and tool
builders, etc.) to the Redex programming language;</p></li><li><p>(2) to demonstrate the method of building abstract interpreters
known as AAM.</p></li></ul><p>You could read this tutorial for either purpose.  If you want to learn
Redex, this tutorial will build a bunch of standard semantic systems:
reduction relations, type judgments, evaluators, machines, and finally
a program analyzer.  If you want an explicit and approachable
introduction to the AAM method, this tutorial will walk you through a
detailed construction.</p><h4>1.1<tt>&nbsp;</tt><a name="(part._.What_is_.Redex_)"></a>What is Redex?</h4><p>Redex<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009%29" class="AutobibLink" data-pltdoc="x">Felleisen et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009%29" class="AutobibLink" data-pltdoc="x">2009</a>)</span> is a scripting language and set of associated tools supporting
the conception, design, construction, and testing of semantic systems
such as programming languages, type systems, program logics, and
program analyses.  As a scripting language, it enables an engineer to
create executable specifications of common semantic elements such as
grammars, reduction relations, judgments, and metafunctions; the basic
elements of formal systems.  It includes a number of software
engineering inspired features to make models robust and includes tools
for typesetting models and generating algebraic steppers for exploring
program behaviors.  In brief, Redex supports all phases of the
semantic engineering life-cycle.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>For an excellent talk motivating Redex, see the video of
Robby Findler&rsquo;s
<span class="emph"><a href="https://www.youtube.com/watch?v=BuCRToctmw0">Run
Your Research</a></span> talk at POPL 2012 <span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Casey._.Klein%2C._.John._.Clements%2C._.Christos._.Dimoulas%2C._.Carl._.Eastlund%2C._.Matthias._.Felleisen%2C._.Matthew._.Flatt%2C._.Jay._.A..._.Mc.Carthy%2C._.Jon._.Rafkind%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Robert._.Bruce._.Findler.Run._.Your._.Research~3a._.On._the._.Effectiveness._of._.Lightweight._.Mechanization.In._.Proc..._.The._39th._.Annual._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T~0a.Symposium._on._.Principles._of._.Programming._.Languages._%28.P.O.P.L%292012%29" class="AutobibLink" data-pltdoc="x">Klein et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Casey._.Klein%2C._.John._.Clements%2C._.Christos._.Dimoulas%2C._.Carl._.Eastlund%2C._.Matthias._.Felleisen%2C._.Matthew._.Flatt%2C._.Jay._.A..._.Mc.Carthy%2C._.Jon._.Rafkind%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Robert._.Bruce._.Findler.Run._.Your._.Research~3a._.On._the._.Effectiveness._of._.Lightweight._.Mechanization.In._.Proc..._.The._39th._.Annual._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T~0a.Symposium._on._.Principles._of._.Programming._.Languages._%28.P.O.P.L%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>)</span>.</p></blockquote></blockquote></blockquote><p>I have used Redex since its first release and it has played a critical
role in several of my research projects.  It has allowed me to rapidly
explore new ideas, hypothesize claims, and&#8212;<wbr></wbr>typically&#8212;<wbr></wbr>refute these
claims and refine the ideas.  In some cases, Redex has eased the
development of research; I can go from idea to result much faster and
more effectively than I could without Redex.  In other cases, using
Redex has illuminated problems I did not know existed, leading to new
results and research.  But in other cases, I simply <span class="emph">could not
have accomplished my research without Redex</span>.</p><p>Redex has become such an integral tool in my research that I cannot
imagine my research path without it.  It has changed the way I
approach and think about problems.</p><h4>1.2<tt>&nbsp;</tt><a name="(part._.What_is_.Abstracting_.Abstract_.Machines_)"></a>What is Abstracting Abstract Machines?</h4><p>Abstracting Abstract Machines (or AAM, for short) is a method for
systematically constructing sound program analyzers.  The central idea
is that a programming language&rsquo;s semantics can be transformed, by a
simple turn-the-crank construction, into an analysis for soundly
reasoning about programs written in that language.  It has been used
to analyze a number of language features often considered beyond the
pale of existing analysis approaches.  A key advantage of the approach
is that ideas from programming language design and implementation can
be directly imported and applied to the design and implementation of
abstract interpreters.</p><h4>1.3<tt>&nbsp;</tt><a name="(part._.Prerequisites)"></a>Prerequisites</h4><p>This tutorial assumes you have some experience with programming
language semantic artifacts such as grammars, reduction relations,
evaluation relations, typing judgments.  If you have never seen these
before, you should probably start with a graduate PL text book
(e.g.<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009%29" class="AutobibLink" data-pltdoc="x">Felleisen et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009%29" class="AutobibLink" data-pltdoc="x">2009</a>)</span>).  It does not assume you have a background in
program analysis or abstract interpretation.</p><p>This tutorial also assumes you have some experience with programming
in a Lisp-like language.  In particular, you should be comfortable
with the concepts behind <span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">quote</a></span>, <span class="RktSym"><a href="http://docs.racket-lang.org/reference/quasiquote.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._quasiquote%29%29" class="RktStxLink" data-pltdoc="x">quasiquote</a></span>, and
<span class="RktSym"><a href="http://docs.racket-lang.org/reference/quasiquote.html#%28form._%28%28quote._~23~25kernel%29._unquote%29%29" class="RktStxLink" data-pltdoc="x">unquote</a></span>.  Having programmed with pattern matching would also
help.</p><p>You will need <a href="http://racket-lang.org/">Racket</a>, which is
very easy to install and works on all major operating systems.  At the
time of writing, version 6.9 is the latest release.</p><p>You can download the source code for this tutorial here:
<a href="https://github.com/dvanhorn/redex-aam-tutorial/archive/master.zip"><span class="url">https://github.com/dvanhorn/redex-aam-tutorial/archive/master.zip</span></a>.</p><h3>2<tt>&nbsp;</tt><a name="(part._.Warmup)"></a>Warmup</h3><p>Redex, at its core, is a language for defining and operating on
s-expressions that is equiped with a powerful pattern matching
mechanism.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>To follow along with this tutorial, you must &lsquo;(require redex)&lsquo; immediately below your &lsquo;#lang racket&lsquo; definition in DrRacket.</p></blockquote></blockquote></blockquote><p>An s-expression is a potentially nested piece of data that may include
numbers, booleans, symbols, and lists of s-expressions.  Before
getting in to how to model semantics with Redex, let&rsquo;s just play with
some simple examples.</p><p><div class="SIntrapara">S-expressions are constructed with the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span> form:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">2</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'fred</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fred</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">green</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(fred (2) (() green))</span></p></td></tr></table></blockquote></div></p><p>If you&rsquo;ve ever programmed with a language in the LISP family, you can
first think of <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span> as being synonymous with <span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">quote</a></span>.</p><p>A <a name="(tech._language)"></a><span style="font-style: italic">language</span> is a set of s-expressions, defined by the
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-language%29%29" class="RktStxLink" data-pltdoc="x">define-language</a></span> form.  For example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-language%29%29" class="RktStxLink" data-pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="hspace">&nbsp;</span><span class="RktSym">wilma</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This defines the language <span class="RktSym">L</span>.  The language <span class="RktSym">L</span> is
inductively defined as the smallest set such that <span class="RktRes">2</span>,
<span class="RktRes">7</span>, <span class="RktRes">fred</span>, and <span class="RktRes">wilma</span> are in
<span class="RktSym">L</span>, and if some values <span class="emph">x<span style="vertical-align: sub; font-size: 80%">0</span></span> through
<span class="emph">x<span style="vertical-align: sub; font-size: 80%">n</span></span> are in <span class="RktSym">L</span>, then the list containing
<span class="emph">x<span style="vertical-align: sub; font-size: 80%">0</span></span> through <span class="emph">x<span style="vertical-align: sub; font-size: 80%">n</span></span> is in <span class="RktSym">L</span>.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>The use of capital letters for non-terminals is just a
convention I follow and not a requirement of Redex.</p></blockquote></blockquote></blockquote><p>The definition of <span class="RktSym">L</span> takes the familiar form of a BNF-like
grammar.  The &ldquo;<span class="RktSym">...</span>&rdquo; postfix operator indicates zero or
more repetitions of the preceding pattern.</p><p>In addition to <span class="RktSym">L</span>, this grammar also carves out
subsets of <span class="RktSym">L</span> defined by the non-terminals of the grammar,
namely <span class="RktSym">M</span>, <span class="RktSym">F</span>, and <span class="RktSym">N</span>.  The non-terminal names
are significant because they become pattern variables which can be
used to match against elements of the language.</p><p><div class="SIntrapara">The simplest operation is to ask whether an s-expression is an element
of one of these sets.  For example:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktVal">9</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">In general, <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span> can use an arbitrary pattern, not
just a non-terminal name:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">The last example demonstrates the use of subscripts in patterns, which
serve to distinguish multiple occurrences of the same non-terminal
name.  Had we left of the subscripts, the pattern would only match
lists of two <span class="emph">identical</span> terms:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote></div></p><p>We can also define functions on terms, called <a name="(tech._metafunction)"></a><span style="font-style: italic">metafunctions</span>
using the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span> form.  A metafunction is given
by an ordered sequence of pattern and template clauses.  For example,
here is a function that swaps occurrences of <span class="RktRes">fred</span> and
<span class="RktRes">wilma</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">wilma</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">wilma</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>There are two imporant things to notice in this example: (1) the
clauses of metafunction definitions are ordered, so the last clause
matches only if the first three do not; (2) the use of
&ldquo;<span class="RktSym">...</span>&rdquo; can also occur on the right-hand side of clauses, so
the third clause distributes the <span class="RktSym">swap</span> call to all of the
elements of the list.</p><p><div class="SIntrapara">Now we can see the difference between <span class="RktSym"><a href="http://docs.racket-lang.org/reference/quote.html#%28form._%28%28quote._~23~25kernel%29._quote%29%29" class="RktStxLink" data-pltdoc="x">quote</a></span> and
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span>: within the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span> form, metafunctions are
interpreted:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wilma</span><span class="hspace">&nbsp;</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(fred wilma)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">quote</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">swap</span><span class="hspace">&nbsp;</span><span class="RktVal">(</span><span class="RktVal">wilma</span><span class="hspace">&nbsp;</span><span class="RktVal">fred</span><span class="RktVal">)</span><span class="RktVal">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(swap (wilma fred))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">7</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">wilma</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fred</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(7 (fred 2 (wilma)))</span></p></td></tr></table></blockquote></div></p><p>It&rsquo;s important to note that metafunction exist within Redex terms and
are not functions in the host language.  Refering to metafunctions
outside of <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span> causes a syntax error:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">swap</span><span class="hspace">&nbsp;</span><span class="RktSym">wilma</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">eval:20:0: swap: illegal use of syntax</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">in: (swap wilma)</span></p></td></tr><tr><td><p><span class="RktErr"></span><span class="hspace">&nbsp;&nbsp;</span><span class="RktErr">value at phase 1: #&lt;term-fn&gt;</span></p></td></tr></table></blockquote><p>Now that we have seen the basics, we can move on to a real example.</p><h3>3<tt>&nbsp;</tt><a name="(part._.P.C.F)"></a>PCF</h3><p>Let&rsquo;s start by building a model of a very simple, typed functional
programming language based on the PCF language<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Gordon._.Plotkin.L.C.F._considered._as._a._programming._language.Theoretical._.Computer._.Science._5%2C._pp..._223--2551977http~3a%2F%2Fhomepages..inf..ed..ac..uk%2Fgdp%2Fpublications%2F.L.C.F..pdf%29" class="AutobibLink" data-pltdoc="x">Plotkin</a> <a href="index.html#%28autobib._.Gordon._.Plotkin.L.C.F._considered._as._a._programming._language.Theoretical._.Computer._.Science._5%2C._pp..._223--2551977http~3a%2F%2Fhomepages..inf..ed..ac..uk%2Fgdp%2Fpublications%2F.L.C.F..pdf%29" class="AutobibLink" data-pltdoc="x">1977</a>)</span>.
Although simple, PCF contains all the essential elements of a real
programming language.  Scaling the approach of these notes up to a
more sophisticated language is just a small matter of semantic
hacking.</p><p>PCF is a core typed functional programming language.  For values, it
includes natural numbers, functions, and primitive operations.  Terms
include variables, values, applications, conditionals, and recursive
functions.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-language%29%29" class="RktStxLink" data-pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">variable-not-otherwise-mentioned</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">O1</span><span class="hspace">&nbsp;</span><span class="RktSym">O2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O1</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktSym">sub1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O2</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">T</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">T</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Greek symbols: you can enter Greek symbols in the
DrRacket IDE by typing many common LaTeX commands followed by
Control-\ (in OS X).  For example &ldquo;\sigma&rdquo; plus Control-\ will enter
&ldquo;&#963;&rdquo;. To make things easier, you can type a unique prefix, so &ldquo;\sig&rdquo;
plus Control-\ will also enter a &ldquo;&#963;&rdquo; as well.</p></blockquote></blockquote></blockquote><p>Compared with the warmup example, there&rsquo;s really not much to point
other than the use of <span class="RktSym">variable-not-otherwise-mentioned</span>, which
is just a shorthand way of saying what&rsquo;s <span class="emph">not</span> a variable name;
in particular, any symbol mentioned in the grammar cannot be a
variable name, so for example <span class="RktRes">&#955;</span>, <span class="RktRes">&#956;</span>,
<span class="RktRes">if0</span>, <span class="RktRes">:</span>, etc., cannot be used as variable
names.  (Had we just used <span class="RktSym">variable</span> instead of
<span class="RktSym">variable-not-otherwise-mentioned</span>, nothing would break (yet),
but it would be ambiguous as to whether some expressions were
applications or lambda abstractions.  Down the line, that probably
will break some of the claims we expect to hold on the language.)</p><p>One thing that is missing from the grammar is the requirement that
<span class="RktRes">&#955;</span>-bound variables are distinct.  We could express this
side condition in the grammar, but instead we&rsquo;ll defer this
requirement to the typing judgment (which we&rsquo;ll see next).</p><p>As an example PCF program, here is a program that computes the
factorial of 5:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fact</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fact</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>(The <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span> form is way to bind a name interpreted
within <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span>.)</p><p><div class="SIntrapara">We can write a test to make sure that this program is indeed in the
language <span class="RktSym">PCF</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test-equal%29%29" class="RktStxLink" data-pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._redex-match~3f%29%29" class="RktStxLink" data-pltdoc="x">redex-match?</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>3.1<tt>&nbsp;</tt><a name="(part._.Typing_judgement)"></a>Typing judgement</h4><p>Let&rsquo;s now define a typing relation for PCF programs.  The typing
relation will, as usual, be defined in terms of a typing environment,
which is missing from the PCF grammar.  Rather than revising the
grammar, we can define a <a name="(tech._language._extension)"></a><span style="font-style: italic">language extension</span> as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCFT</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The <span class="RktSym">PCFT</span> language includes everything in the <span class="RktSym">PCF</span>
language, plus a notion of type environments <span class="RktSym">&#915;</span>, which are
sequences of variable and type pairs.  (Language extensions can also
replace or augment existing non-terminals, as we&rsquo;ll see later.)</p><p>Let&rsquo;s first take a detour to develop some useful, general purpose
helper functions.</p><p>Association lists, like <span class="RktSym">&#915;</span>, come up again and again, so let&rsquo;s
define a few operations for them.  Since association lists are more
general than type environments, we&rsquo;ll want to define generic versions
of this operations.  In order to be generic, we should only use the
built-in patterns of Redex and not the metavariables of languages we
define.  To accomodate this, we first define the language of built-in
patterns:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-language%29%29" class="RktStxLink" data-pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This definition introduces no non-terminals, so it includes only the
built-in patterns like <span class="RktSym">number</span>, <span class="RktSym">variable</span>,
<span class="RktSym">...</span>, etc.  When we define generic operations, we will define
them in the language of <span class="RktSym">REDEX</span>.</p><p>First, let&rsquo;s write a straightforward recursive judgment form that
relates a given key to all its associations:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mode</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:contract</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any_0</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This relation makes use of the <span class="RktSym">any</span> pattern, which ranges
over all values.  It also uses the <span class="RktSym">_</span> pattern, which like
<span class="RktSym">any</span>, will match anything, but unlike <span class="RktSym">any</span> it is not a
binder and therefore (1) it cannot be used on the right hand side and
(2) multiple occurrences of <span class="RktSym">_</span> on the left hand side are not
constrained to match the same thing.</p><p>The clause uses a non-linear pattern to require a binding to match the
given key (notice the two left-hand occurrences of <span class="RktSym">any</span>).</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1 3)</span></p></td></tr></table></blockquote><p>In addition to looking up an association, we need an operation to
extend an association list.  A simple definition that allows for an
association to be extended with an arbitrary number of key-value pairs
is then:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">ext1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any_0</span><span class="hspace">&nbsp;</span><span class="RktSym">any_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any_0</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The <span class="RktSym">ext</span> metafunction overrides an existing association, if
there is one; otherwise it prepends the new association to the list.</p><p>Lastly, we will want to assert that <span class="RktSym">&#955;</span>-bound variables are
unique, so let&rsquo;s define a <span class="RktSym">unique</span> predicate, which holds when
its arguments are distinct:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">boolean</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_!_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#f</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This defines a <span class="RktSym">unique</span> metafunction that takes a list of
any number of elements and produces <span class="RktVal">#t</span> when they are unique and
<span class="RktVal">#f</span> otherwise.  This uses a new kind of pattern, which uses
the <span class="stt">_!</span> naming prefix.  The meaning of this pattern is that
repeated uses of it must be distinct, thus <span class="RktSym">any_!_1</span><span class="stt"> </span><span class="RktSym">...</span>
matches disjoint sequences.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote><p>There is a kind of short-hand for defining predicates (metafunctions
that produce either true or false), called, confusingly enough,
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8838;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_!_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><div class="SIntrapara">It can be used just like a metafunction:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="hspace">&nbsp;</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#f</span></p></td></tr></table></blockquote></div></p><p>With these generic operations in place, we can now define the typing
relation &ldquo;<span class="RktSym">&#8866;</span>&rdquo;:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCFT</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mode</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:contract</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">--------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">var</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><span class="nobreak">-------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><span class="nobreak">-----------------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">op1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">O1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym"><span class="nobreak">---------------------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">op2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">O2</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">---------------------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">if0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">-----------------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#956;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">T_1</span><span class="hspace">&nbsp;</span><span class="RktSym">..._1</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">-----------------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">app</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">..._1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">unique</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_n</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">------------------------------------------</span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#955;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#915;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">T</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">T_n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span> specifies a <a name="(tech._relation)"></a><span style="font-style: italic">relation</span>.
Conceptually, a relation in Redex is a function from inputs to sets of
outputs and the definition of a relation must specify which positions
of the relation are inputs and which are outputs, as seen in the
<span class="RktPn">#:mode</span> spec.  This relation has three inputs (although the
last one is always the constant &ldquo;<span class="RktRes">:</span>&rdquo; to make the form
easier to read) and one output.  The two real inputs are the type
environment and term; the output is the type.  The <span class="RktPn">#:contract</span>
annotation specifies the signature of the relation.</p><p>A relation is specifed by a number of clauses.  Each clause has some
number of hypotheses (calls to this or other judgments) and side
conditions (noted with <span class="RktSym">where</span>), followed by a line, an
optional name, and a conclusion.  Unlike metafunctions, the clauses
are unordered and therefore may overlap.</p><p>Judgments must be &ldquo;well-moded&rdquo;.  If some variable appears in an
output position of a conclusion but cannot be determined based on
inputs or outputs of hypotheses, a static error will be signalled.</p><p>Judgments can be used either with the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span> form or
from other judgment definitions or metafunctions.  The
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span> form works as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#t</span></p></td></tr></table></blockquote><p>This use specifies a type <span class="RktRes">(num<span class="stt"> </span><span class="nobreak">-&gt;</span><span class="stt"> </span>num)</span> and verifies this type
is in the typing relation.</p><p>Alternatively, we can use a metavariable in the type position in
order to compute all of the types this term has.  This metavariable is
bound to these types in the scope of the following term which, in this
case is just <span class="RktSym">T</span>.  Consequently the result is the list of types
for this program.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((num -&gt; num))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(num)</span></p></td></tr></table></blockquote><p>It&rsquo;s possible to illustrate judgments as follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._show-derivations%29%29" class="RktValLink" data-pltdoc="x">show-derivations</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._build-derivations%29%29" class="RktStxLink" data-pltdoc="x">build-derivations</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><img src="show-derivations.png" alt="" width="648" height="287"/></p><p>We can verify that ill-formed lambda-abstractions have no type:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8866;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote><p>Enough types, let&rsquo;s calculate!</p><h4>3.2<tt>&nbsp;</tt><a name="(part._.The_calculus_of_.P.C.F)"></a>The calculus of PCF</h4><p>To calculate with PCF programs, we start by formulating a
<a name="(tech._reduction._relation)"></a><span style="font-style: italic">reduction relation</span> that captures the axioms of reduction for
PCF:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF</span><span class="hspace">&nbsp;</span><span class="RktPn">#:domain</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#956;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#946;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#948;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">if-t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">side-condition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._zero~3f%29%29" class="RktValLink" data-pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">if-f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>A reduction relation defines a binary relation on terms in a given
domain, in this case terms <span class="RktSym">M</span>.  A reduction relation is
defined by a number of clauses, noted with <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span>, which consist
of a left-hand side, a right-hand side, any number of side conditions,
and optional name.  The order of clauses is irrelevant and like
judgments, clauses may overlap.</p><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Even though reduction relations are relations, and conceptually can be
thought of as a judgment with <span class="RktPn">#:mode</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">r</span><span class="stt"> </span><span class="RktSym">I</span><span class="stt"> </span><span class="RktSym">O</span><span class="RktPn">)</span> and
<span class="RktPn">#:contract</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym">r</span><span class="stt"> </span><span class="RktSym">M</span><span class="stt"> </span><span class="RktSym">M</span><span class="RktPn">)</span>, they are considered different from
Redex&rsquo;s point of view and support different operations.</p></blockquote></blockquote></blockquote><p>This definition relies on two auxilary definitions: a <span class="RktSym">&#948;</span>
relation for interpreting primitive operations and a <span class="RktSym">subst</span>
metafunction which implements substitution.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mode</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:contract</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Note that this judgment omits the horizontal lines, which are in fact
optional (but conclusions precede hypotheses when omitted; of course
it makes no difference when there are no hypotheses as is the case
with <span class="RktSym">&#948;</span>).  It also uses <span class="RktSym"><a href="http://docs.racket-lang.org/reference/quasiquote.html#%28form._%28%28quote._~23~25kernel%29._unquote%29%29" class="RktStxLink" data-pltdoc="x">unquote</a></span>, written
&ldquo;<span class="stt">,</span>&rdquo; to escape out of Redex and into Racket.  Thus the
interpration of PCF&rsquo;s <span class="RktRes">+</span> is given by Racket&rsquo;s <span class="RktSym">+</span>
function, and likewise for the rest of the operations.</p><p><div class="SIntrapara">The substitution operation is straightforward, if a bit tedious.  We
defer it to an appendix and future models will simply avoid the need
for subsitution.  If you&rsquo;d like, you can install this package on the
command line: </div><div class="SIntrapara"><span class="hspace">&nbsp;&nbsp;</span><span class="stt">$ raco pkg install redex-aam-tutorial</span></div><div class="SIntrapara"> and
then import the <span class="RktSym">subst</span> metafunction as follows:</div></p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/require.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._require%29%29" class="RktStxLink" data-pltdoc="x">require</a></span><span class="hspace">&nbsp;</span><span class="RktSym">redex-aam-tutorial/subst</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(+ 5 7)</span></p></td></tr></table></blockquote><p><div class="SIntrapara">We can now use <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span> to see the results of
applying the <span class="RktSym">r</span> reduction relation to a term:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(6)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((add1 5))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote></div></p><p>The second example shows that <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span> only
takes <span class="emph">one</span> step of computation since clearly <span class="RktRes">(add1<span class="stt"> </span>5)</span> can reduce further.  The third example shows that reduction can
only occur at the outermost term; despite having multiple redexes
inside the term, the term itself does not reduce.</p><p><div class="SIntrapara">Using <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span> will take any number of steps
and return the set of irreducible terms:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(6)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(6)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((sub1 ((&#955; ((x : num)) x) (add1 5))))</span></p></td></tr></table></blockquote></div></p><p>Of course, the reflexive, transitive closure of <span class="RktSym">r</span>, which is
what <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span> computes, still does not
enable reductions within terms, so the last example does not reduce.</p><p>We could define another reduction relation which incorporates progress
rules.  Alternatively, we can use operations to compute such a
relation from <span class="RktSym">r</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._compatible-closure%29%29" class="RktStxLink" data-pltdoc="x">compatible-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">#&lt;reduction-relation&gt;</span></p></td></tr></table></blockquote><p>This example of the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._compatible-closure%29%29" class="RktStxLink" data-pltdoc="x">compatible-closure</a></span> operation computes a
new relation that allows <span class="RktSym">r</span> to be applied anywhere within a
term <span class="RktSym">M</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._compatible-closure%29%29" class="RktStxLink" data-pltdoc="x">compatible-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(6)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(5)</span></p></td></tr></table></blockquote><p>It&rsquo;s also possible to visualize each step of reduction using the
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._traces%29%29" class="RktValLink" data-pltdoc="x">traces</a></span> function, which launches a window showing each path of
reduction.  For example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._traces%29%29" class="RktValLink" data-pltdoc="x">traces</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>produces:</p><p><img src="reduction.png" alt="" width="416" height="393"/></p><p>Notice that the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._traces%29%29" class="RktValLink" data-pltdoc="x">traces</a></span> window visualizes all possible
reduction sequences.</p><h4>3.3<tt>&nbsp;</tt><a name="(part._.Call-by-value_and_call-by-name__.Strategies__contexts__and_axioms)"></a>Call-by-value and call-by-name: Strategies, contexts, and axioms</h4><p>It is possible to consider reduction <span class="emph">strategies</span> which fix a
deterministic order to reductions.  One way to represent such a
strategy is to define a grammar of <a name="(tech._evaluation._context)"></a><span style="font-style: italic">evaluation contexts</span> that
restrict where the reduction relation <span class="RktSym">r</span> may be applied.</p><p><div class="SIntrapara">For example, to obtain a reduction strategy that always reduces the
left-most, outer-most redex, we can define evaluation context as
follows:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCFn</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>Now using <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span>, we can compute a relation that
does the left-most, outer-most call-by-name reduction.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>n</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">PCFn</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._traces%29%29" class="RktValLink" data-pltdoc="x">traces</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><img src="cbn-reduction.png" alt="" width="388" height="410"/></p><p>Unlike <span class="RktSym"><span class="nobreak">--&gt;</span>r</span>, we can use <span class="RktSym"><span class="nobreak">--&gt;</span>n</span> to calculate
<span class="RktSym">fact-5</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote><p><div class="SIntrapara">We can also turn the example into a unit test:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>While we can&rsquo;t use <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span> to compute
<span class="RktSym">fact-5</span> with <span class="RktSym"><span class="nobreak">--&gt;</span>r</span>, we can test <span class="RktSym"><span class="nobreak">--&gt;</span>r</span> with
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e~e2~88~83%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;&#8707;</a></span>, which tests for reachability:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e~e2~88~83%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;&#8707;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>Why doesn&rsquo;t <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="stt"> </span><span class="RktSym"><span class="nobreak">--&gt;</span>r</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="stt"> </span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span> produce an answer?</p></blockquote></blockquote></blockquote><p>In addition to call-by-name, we can also characterize left-most,
outer-most call-by-value reduction with the following strategy and a
restriction of the <span class="RktSym">&#946;</span> axiom:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCFv</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">r</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span><span class="hspace">&nbsp;</span><span class="RktPn">#:domain</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#946;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v</span><span class="hspace">&nbsp;</span><span class="RktSym">PCFv</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Notice that <span class="RktSym">v</span> is defined as an
<span class="RktSym">extended-reduction-relation</span> of <span class="RktSym">r</span>.  An extension of a
reduction relation can add additional reduction cases or override
existing ones, as is the case here, by providing a new rule with the
same name as an existing one.</p><p>Like <span class="RktSym"><span class="nobreak">--&gt;</span>n</span>, the <span class="RktSym"><span class="nobreak">--&gt;</span>v</span> relation defines a deterministic
reduction strategy, but it differs from <span class="RktSym"><span class="nobreak">--&gt;</span>n</span> in <span class="emph">where</span>
it reduces and <span class="emph">what</span> it reduces:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._traces%29%29" class="RktValLink" data-pltdoc="x">traces</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><img src="cbv-reduction.png" alt="" width="388" height="396"/></p><p><div class="SIntrapara">And like <span class="RktSym"><span class="nobreak">--&gt;</span>n</span>, it produces an answer for <span class="RktSym">fact-5</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote></div></p><p>If the relations <span class="RktSym"><span class="nobreak">--&gt;</span>n</span> and <span class="RktSym"><span class="nobreak">--&gt;</span>v</span> produce answers, they
are consistent with each other, but the <span class="RktSym"><span class="nobreak">--&gt;</span>n</span> relation
produces more answers than <span class="RktSym"><span class="nobreak">--&gt;</span>v</span> as the following examples
demonstrate:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#937;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">loop</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#937;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(0)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#937;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote><p>These examples also show that Redex terminates, even when the
reduction of a term has a cycle in it.</p><h4>3.4<tt>&nbsp;</tt><a name="(part._.Evaluation)"></a>Evaluation</h4><p>As an alternative to the reduction-based approach of the previous
subsection, computation is often characterized by a compositional
evaluation function.  This approach avoids substitution and instead
represents substitutions lazily with a <a name="(tech._closure)"></a><span style="font-style: italic">closure</span>, which is a
term paired with an environment mapping variable names to values:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Like type environments, value environments are instances of
association lists, so we will use the generic <span class="RktSym">lookup</span> and
<span class="RktSym">ext</span> operations.</p><p>The evaluation function <span class="RktSym">&#8659;</span> can now be defined as a judgment as
follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#8659;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mode</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:contract</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">--------------</span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28quote._~23~25kernel%29._if%29%29" class="RktStxLink" data-pltdoc="x">if</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/number-types.html#%28def._%28%28quote._~23~25kernel%29._zero~3f%29%29" class="RktValLink" data-pltdoc="x">zero?</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">---------------------------</span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">-----------------------</span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">-----------------------------------</span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym"><span class="nobreak">-----------------------------------------</span></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_0</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We can use it to compute examples:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote><p><div class="SIntrapara">Or test:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test-equal%29%29" class="RktStxLink" data-pltdoc="x">test-equal</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8659;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><h4>3.5<tt>&nbsp;</tt><a name="(part._.A_brief_aside_on_the_caveats_of_language_extensions)"></a>A brief aside on the caveats of language extensions</h4><p>Redex, as we&rsquo;ve seen, has some powerful features to support extension,
and this tutorial uses them, well, <span class="emph">extensively</span>.  However, there
are some gothchas worth being aware of.</p><p>One of the most prominent gotchas is the mixing of reduction relation
extensions and metafunctions (or relations).</p><p>When a reduction relation is extended, the original relation is
reinterpreted over the new language; thus the original pattern
variables of the original definition may take on new meaning.  So for
example, consider this simple language and reduction relation:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-language%29%29" class="RktStxLink" data-pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">number</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(5)</span></p></td></tr></table></blockquote><p>Suppose we then extend <span class="RktSym">L0</span> by overriding the meaning of
<span class="RktSym">M</span> to include strings:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="hspace">&nbsp;</span><span class="RktSym">L0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">....</span><span class="hspace">&nbsp;</span><span class="RktSym">string</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>We can create an extension of <span class="RktSym">r0</span> that is the reinterpretation
of <span class="RktSym">r0</span> over this new meaning of <span class="RktSym">M</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r0&#8242;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r0</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>This works just fine and <span class="RktSym">r0&#8242;</span> reduces as expected when applied
to strings:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r0&#8242;</span><span class="hspace">&nbsp;</span><span class="RktVal">"seven"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(5)</span></p></td></tr></table></blockquote><p>However, let&rsquo;s consider an alternative, seemingly equivalent
development of the base relation that involves a metafunction:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">to-five</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">to-five</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">to-five</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(5)</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r1&#8242;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r1</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>You might expect that the extension of <span class="RktSym">r1</span> to <span class="RktSym">L1</span>
would also reinterpret the definition of <span class="RktSym">to-five</span>, but it does
not.  Consequently, applying <span class="RktSym">r1&#8242;</span> to a string results in a
run-time domain error from applying <span class="RktSym">to-five</span> to a string:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r1&#8242;</span><span class="hspace">&nbsp;</span><span class="RktVal">"seven"</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktErr">to-five: (to-five "seven") is not in my domain</span></p></td></tr></table></blockquote><p>Relaxing the contract on <span class="RktSym">to-five</span> is no help either; using a
more relaxed contract such as <span class="RktSym">any</span><span class="stt"> </span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="stt"> </span><span class="RktSym">any</span> would shift the
error to a failure to match since the <span class="RktSym">M</span> in the definition of
<span class="RktSym">to-five</span> is still an <span class="RktSym">M</span> in <span class="RktSym">L0</span> and thus
doesn&rsquo;t match strings.</p><p>But isn&rsquo;t there a mechanism for extending metafunctions?  Yes.  There
is <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%2Fextension%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction/extension</a></span>, which allows you to define a
<span class="RktSym">L1</span> compatible version of <span class="RktSym">to-five</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%2Fextension%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction/extension</a></span><span class="hspace">&nbsp;</span><span class="RktSym">to-five</span><span class="hspace">&nbsp;</span><span class="RktSym">L1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">to-five/L1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">to-five/L1</span><span class="hspace">&nbsp;</span><span class="RktVal">"seven"</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">5</span></p></td></tr></table></blockquote><p>This defines a new metafunction, <span class="RktSym">to-five/L1</span>, which
reinterprets the definition of <span class="RktSym">to-five</span> over <span class="RktSym">L1</span>.  (We
could aslo have added clauses to this definition, which are
conceptually prepended to those of <span class="RktSym">to-five</span>, but there&rsquo;s no
need in this case.)  However, this has no effect on the original
definition of <span class="RktSym">to-five</span>, which is what is used within
<span class="RktSym">r1</span> <span class="emph">and</span> its extension <span class="RktSym">r1&#8242;</span>.  So the problem
remains.</p><p>We could have used <span class="RktSym">to-five/L1</span> in the original definition of
<span class="RktSym">r1</span>, but this puts the cart before the horse since we have to
anticipate all extensions before writing the base relation.</p><p>We could have named and then overridden this case of the relation in
<span class="RktSym">r1&#8242;</span>, but this just subverts the original goal of extension,
which is to enable a single point of control; this approach duplicates
code and inflicts all the problems that follow.</p><p>The approach we take in this tutorial is to avoid all
language-specific metafunction, relations, and judgments when defining
reduction relations.  We use instead only metafunctions, relations,
and judgments that are either (1) defined only in terms of Redex&rsquo;s
built in patterns (for example, <span class="RktSym">lookup</span>, <span class="RktSym">ext</span>, and
<span class="RktSym">unique</span>); or (2) defined only for some subset of the language
which doesn&rsquo;t change in extensions (for example, <span class="RktSym">&#948;</span>).  It is a
compromise, but short of better extension mechanisms in Redex, it
seems to be a reasonable practice.</p><h4>3.6<tt>&nbsp;</tt><a name="(part._.Explicit_substitutions)"></a>Explicit substitutions</h4><p>As an intermediary between the compositional evaluation function based
on value environments and closures and the reduction system based on
substitution, we can also formulate computation as a reduction system
based on environments that is substitution-free.  Such a reduction
semantics is known as an <a name="(tech._explicit._substitution)"></a><span style="font-style: italic">explicit substitution</span> semantics
since the meta-theoretic notion of substitution is represented
explicitly in the system<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Mart~c3~adn._.Abadi%2C._.Luca._.Cardelli%2C._.Pierre-.Louis._.Curien%2C._and._.Jean-.Jacques._.L~c3~a9vy.Explicit._.Substitutions.Journal._of._.Functional._.Programming._1%284%29%2C._pp..._375--4161991%29" class="AutobibLink" data-pltdoc="x">Abadi et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Mart~c3~adn._.Abadi%2C._.Luca._.Cardelli%2C._.Pierre-.Louis._.Curien%2C._and._.Jean-.Jacques._.L~c3~a9vy.Explicit._.Substitutions.Journal._of._.Functional._.Programming._1%284%29%2C._pp..._375--4161991%29" class="AutobibLink" data-pltdoc="x">1991</a>)</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#8659;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Values are just as in the <span class="RktSym">PCF&#8659;</span> language, but closures are
generalized to either terms with environments, or conditionals or
applications with closure sub-terms.  The reduction relation is now
defined on the domain of closures:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v&#961;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">#:domain</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;-app</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;-op</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;-num</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#961;-x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#946;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">rec-&#946;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#948;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">if-t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">side-condition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/Equality.html#%28def._%28%28quote._~23~25kernel%29._equal~3f%29%29" class="RktValLink" data-pltdoc="x">equal?</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">if-f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The <span class="RktSym">&#961;-if</span> and <span class="RktSym">&#961;-app</span> rules distribute environments to
sub-terms of conditionals and applications, respectively.  The
<span class="RktSym">&#961;-op</span> and <span class="RktSym">&#961;-num</span> rules drop needless environments from
primitives and numbers.  The <span class="RktSym">&#961;-x</span> rule looks up the value of a
variable in an environment.  The remaining cases are straightforward
adaptations of the <span class="RktSym">v</span> relation to the domain of closures.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#961;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">E</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><div class="SIntrapara">Let&rsquo;s define a simple injection from terms to closures:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#961;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">inj&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">C</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">inj&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div><div class="SIntrapara">which we can use to inject programs into initial configurations
before reducing:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote></div></p><p>One of the nice properties of this explicit substitution formulation
is that we don&rsquo;t need a substitution metafunction, which is good since
substitution is both tedious to write and easy to get wrong.</p><h4>3.7<tt>&nbsp;</tt><a name="(part._.Eval_.Continue_.Apply_machine)"></a>Eval/Continue/Apply machine</h4><p>Explicit substitutions explicate the handling of variable bindings and
take a principled step from a theoretical calculus toward a realistic
language implementation.  But the <span class="RktSym"><span class="nobreak">--&gt;</span>v&#961;</span> relation of the
previous section still leaves implicit the process of decomposing a
program into an evaluation context and a redex, then plugging the
contractum back into the context to obtain the new state of the
program.  In this section, we develop a stack machine that makes
explicit the mechanism for finding redexes, thus eliminating the need
for the <span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span> operation.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#961;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">K</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">serious terms S &#8745; V = &#8709;, C = S &#8746; V</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We start by formulating a representation of the context.  An
evaluation context will be represented as a <a name="(tech._continuation)"></a><span style="font-style: italic">continuation</span>: a
list of <a name="(tech._frame)"></a><span style="font-style: italic">frame</span>s, where a frame is a single flat evaluation
context, i.e. either a conditional or application context with no
nested evaluation context inside (the hole will be represented by
<span class="RktRes">[]</span>).  Conceptually, the continuation is a stack of
actions that remain to be done.  It&rsquo;s also easy to see that
continuations and evaluation contexts are inter-convertible: the
inner-most part of an evaluation context is the first frame of a
continuation; the outer-most part of the context corresponds to the
final frame of a continuation; an empty context is represented by an
empty list of frames.</p><p>Computation is defined over the domain of <span class="emph">states</span>, which are
closures paired with a continuation; the final state of a computation
is just a value.</p><p>The transitions of this machine break down into three categories:
<span class="emph">apply</span> transitions, which actually perform closure reduction;
<span class="emph">eval</span> transitions, which push actions on to the continuation;
and <span class="emph">continue</span> transitions which pop actions of the continuation
and search for the next redex.</p><p>In order to determine when a frame should be pushed on the stack, we
define a category of <a name="(tech._seriou)"></a><span style="font-style: italic">serious</span> terms <span class="RktSym">S</span>, which are
non-value closures.  If a conditional or application contains a
serious term, a frame is pushed.  If the closure component of the
state is a value, the top frame is popped and the value is plugged
into its hole; if the stack is empty, the value is the final result of
the computation.  If the closure component is a redex, it is reduced
using <span class="RktSym">v&#961;</span>.</p><p>The apply transitions are obtained by lifting <span class="RktSym">v&#961;</span> to operate
on states; here we use the <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="stt"> </span><span class="RktSym">v&#961;</span><span class="stt"> </span><span class="RktSym">PCF&#962;</span><span class="stt"> </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="stt"> </span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span>
to obtain this relation.  The eval and continue transitions are
straightforward and make explicit as reductions what
<span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span> computes.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Apply</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym">v&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#962;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#962;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Eval</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ev-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ev-app</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Continue</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">halt</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">co-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">C_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">co-app</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Again, we define an injection into initial configurations:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#962;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">inj&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#962;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">inj&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">inj&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We can verify the machine computes the expected results:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote><p>If we examine the reduction graph for a program, what we see is that
the graph for a <span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span> computation is just like <span class="RktSym"><span class="nobreak">--&gt;</span>v&#961;</span>
computation, but with more transitions corresponding to the
decomposition and recomposition of programs into evaluation contexts
and redexes.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fgui..rkt%29._traces%29%29" class="RktValLink" data-pltdoc="x">traces</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#962;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><img src="machine-reduction.png" alt="" width="612" height="792"/></p><h4>3.8<tt>&nbsp;</tt><a name="(part._.Heap-allocated_bindings)"></a>Heap-allocated bindings</h4><p>In order to model imperative features such as references, arrays, or
mutable variables&#8212;<wbr></wbr>or even just to give an object-level account of
memory allocation, rather than an implicit meta-level account&#8212;<wbr></wbr>we
need to incorporate a <a name="(tech._heap)"></a><span style="font-style: italic">heap</span>, a mapping from addresses (or
pointers, or locations, etc.) to values.  Our language doesn&rsquo;t have
any imperative features, however as we&rsquo;ll see using a heap-based
machine model is an important component of the AAM approach to
constructing analyses.  We will now add a heap and use it to account
for the memory used to bind variables when a function is applied.</p><p>In this model, we create a level of indirection in variable bindings
so that environments will now map from variable names to addresses and
the heap will resolve these addresses to values.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#962;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The reduction relation <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span> will consist of <span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span>,
lifted to operate within the context <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="stt"> </span><span class="RktSym">&#931;</span><span class="RktPn">)</span>, but then
overriding the variable binding and dereference rules to allocate and
dereference bindings via the heap:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">discard-&#931;-N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">discard-&#931;-O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#961;-x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#946;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">A_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A_f</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A_f</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">rec-&#946;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>We&rsquo;ve also added two rules for discarding the heap for final states
that consist of numbers or primitive operations since the heap is
irrelevant.  For function results though, we&rsquo;ll need to keep the heap
to make sense of any environments inside the result.</p><p><div class="SIntrapara">As usual, we give an injection function:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">inj&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></p><p>The <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span> relation relies on a helper metafunction
<span class="RktSym">alloc</span>, which allocates address for variables bindings.
First, we define a metafunction for extracting formal parameter names:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The <span class="RktSym">alloc</span> metafunction consumes a state representing a
<span class="RktSym">&#946;</span> or <span class="RktSym">rec-&#946;</span> redex and it produces a fresh address for
each formal parameter name:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._list%29%29" class="RktValLink" data-pltdoc="x">list</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._gensym%29%29" class="RktValLink" data-pltdoc="x">gensym</a></span><span class="hspace">&nbsp;</span><span class="RktSym">x</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><blockquote class="refpara"><blockquote class="refcolumn"><blockquote class="refcontent"><p>A transgression has just occurred.  Can you spot it?</p></blockquote></blockquote></blockquote><p>For example:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((y y2359) (z z2360))</span></p></td></tr></table></blockquote><p>Note that addresses have some structure under this allocation
strategy; an address is a 2-element list consisting of the variable
name being bound followed by a unique symbol for this particular
binding.  Only the latter symbol is needed to guarantee freshness, but
as well see, this strategy is useful to relate concrete and
approximating machines.</p><p>When a redex is contracted, we see the bindings in the heap:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'((((y ((y (y y2361)) (z (z z2362)))) ()) (((y y2361) 5) ((z z2362) 7))))</span></p></td></tr></table></blockquote><p>Finally, we can verify the heap-based semantics remains faithful to
previous semantics and computes the correct result for
<span class="RktSym">fact-5</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote><p>It&rsquo;s easy to see that from an initial configuration <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span>
reduction operates in lock-step with <span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span> reduction (modulo
the possibility of a final <span class="RktSym">discard-&#931;</span> step and some
&ldquo;stuttering&rdquo; steps).</p><blockquote class="SubFlow"><p><a name="(counter._(exercise._asdf))"></a><span style="font-weight: bold">Exercise</span>&nbsp;1. Formulate and test an equivalence invariant between
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span> and <span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span>. &#9632;</p></blockquote><h4>3.9<tt>&nbsp;</tt><a name="(part._.Abstracting_over_alloc)"></a>Abstracting over <span class="RktSym">alloc</span></h4><p>In the previous section, we broke one of our design principles: we
wrote a reduction relation that relies on a language-specific
metafunction, namely <span class="RktSym">alloc</span>.</p><p>We could try to rewrite <span class="RktSym">alloc</span> to be language independent, but
it&rsquo;s not clear this will work in the long-run.  Unlike <span class="RktSym">lookup</span>
and <span class="RktSym">ext</span>, the <span class="RktSym">alloc</span> metafunction is fundamentally
tied to the <span class="RktSym">PCF&#963;</span> language.</p><p>In this section, we explore another option for writing extensible
reduction relations that depend on language-specific metafunctions: we
abstract over these metafunctions.</p><p>The problem with abstracting over a metafunction is that a
metafunction is not a value.  So we can&rsquo;t use functional abstraction
and pass in <span class="RktSym">alloc</span> as a parameter to a function that returns a
reduction relation, i.e. the following won&rsquo;t work:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&#171;RHS</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">of</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">definition&#187;</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">recreate</span><span class="hspace">&nbsp;</span><span class="RktCmt">original</span><span class="hspace">&nbsp;</span><span class="RktCmt">definition:</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>Luckily, Racket includes mechanisms for <span class="emph">syntactic abstraction</span>,
enabling abstraction over syntax, which is exactly what is needed
here.  So we solve our problem by creating a syntactic shorthand as
follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&#171;RHS</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">of</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">definition&#187;</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta">&#160;</span></td></tr><tr><td><span class="RktMeta"></span><span class="RktCmt">;;</span><span class="hspace">&nbsp;</span><span class="RktCmt">recreate</span><span class="hspace">&nbsp;</span><span class="RktCmt">original</span><span class="hspace">&nbsp;</span><span class="RktCmt">definition:</span><span class="RktMeta"></span></td></tr><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>This definition tells Racket to syntactically replace any occurrences
of <span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="stt"> </span><span class="RktSym">E</span><span class="RktPn">)</span> with the RHS code, substitution <span class="RktSym">E</span>
for occurrences of the name <span class="RktSym">alloc</span>, where <span class="RktSym">E</span> may be an
arbitrary piece of syntax.</p><p>There is just one minor snag: Racket&rsquo;s <span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span>
mechanism has its own use of <span class="RktSym">...</span>, which conflicts with the
occurrences of <span class="RktSym">...</span> in the definition of <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span>.  To
side-step the issue, we just need to quote the ellipses of the
definition, indicating that they should be treated literally and not
interpreted as <span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span>&rsquo;s ellipsis.  To accomplish
this, we do the following:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktPn">(</span><span class="RktSym">...</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">&#171;RHS</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">of</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><span class="RktSym">definition&#187;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktMeta"></span></td></tr></table></blockquote><p>The full code is now:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">discard-&#931;-N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">discard-&#931;-O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#961;-x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#946;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">A_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A_f</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A_f</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">rec-&#946;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">recreate original definition:</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p><div class="SIntrapara">We can re-verify the relation works as expected:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote></div></p><p>Of course, now we can experiment with different allocation strategies,
such as one that generates fresh symbols, or another that uses the
smallest available natural number:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc-gensym</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">alloc-gensym</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._gensym%29%29" class="RktValLink" data-pltdoc="x">gensym</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc-nat</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">alloc-nat</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">_</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/let.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._let%29%29" class="RktStxLink" data-pltdoc="x">let</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/procedures.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._apply%29%29" class="RktValLink" data-pltdoc="x">apply</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/generic-numbers.html#%28def._%28%28quote._~23~25kernel%29._max%29%29" class="RktValLink" data-pltdoc="x">max</a></span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Flist..rkt%29._build-list%29%29" class="RktValLink" data-pltdoc="x">build-list</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28quote._~23~25kernel%29._length%29%29" class="RktValLink" data-pltdoc="x">length</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">formals</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">i</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">+</span><span class="hspace">&nbsp;</span><span class="RktSym">i</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc-gensym</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc-nat</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>For any allocation function <span class="RktVar">alloc</span>, so long as
<span class="RktPn">(</span><span class="RktVar">alloc</span><span class="stt"> </span><span class="RktSym">&#963;</span><span class="RktPn">)</span> produces an address not in <span class="RktSym">&#963;</span>, then
<span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="stt"> </span><span class="RktVar">alloc</span><span class="RktPn">)</span> computes the same reduction as
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span>&#8212;<wbr></wbr>up to the choice of addresses&#8212;<wbr></wbr>using any other
allocation function that similarly produces fresh names.</p><h4>3.10<tt>&nbsp;</tt><a name="(part._.Heap-allocated_continuations)"></a>Heap-allocated continuations</h4><p>Just as bindings can be allocated in the heap, so too can
continuations.  In this section, we develop a variant of the previous
semantics that abandons the stack model, instead modelling the
continuation as a linked-list structure allocated in the heap.</p><p>There are several practical reasons one might want to do this; for
example, this is the implementation strategy of many languages
supporting first-class continuations.  However, as we&rsquo;ll see, this is
another step relevant to the AAM approach for constructing finite
models of programs.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;*</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">K</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">U</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">U</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>The <span class="RktSym">PCF&#963;*</span> overrides the grammar of continuations in the
<span class="RktSym">PCF&#963;</span> language.  A continuation is now either empty or a
single frame with a pointer to the rest of the continuation.  Heaps
are extended to associated addresses to either values or
continuations.</p><p><div class="SIntrapara">The reduction relation <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span> is just like <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span>
except that it
</div><div class="SIntrapara"><ul><li><p>replaces the eval transitions with alternatives that
allocate frames in the heap instead of pushing on the stack, and</p></li><li><p>replaces the continue transitions with alternatives that
dereference the current frame pointer and install a new continuation
instead of popping the stack.</p></li></ul></div></p><p>Because we need to allocate continuation pointers, an extension of
<span class="RktSym">alloc</span> is required:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%2Fextension%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction/extension</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._gensym%29%29" class="RktValLink" data-pltdoc="x">gensym</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">if0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/symbols.html#%28def._%28%28quote._~23~25kernel%29._gensym%29%29" class="RktValLink" data-pltdoc="x">gensym</a></span><span class="hspace">&nbsp;</span><span class="RktVal">'</span><span class="RktVal">app</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This allocation strategy is designed in a way similar to
<span class="RktSym">alloc</span>: given a configuration that is about to make a continue
transition, it produces a two element list, the first element is the
frame for which we are allocating, the second is a unique symbol.
Only the second component is necessary, but the first is helpful for
making sense of what&rsquo;s going on.</p><p><div class="SIntrapara">Some examples:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">3</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">4</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(((if0 () (3 ()) (4 ())) if02886))</span></p></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(((((&#955; ((y : num)) y) ()) ()) app2888))</span></p></td></tr></table></blockquote></div></p><p>The <span class="RktSym">alloc*</span> metafunction is an extension of <span class="RktSym">alloc</span>, so
it behaves just like <span class="RktSym">alloc</span> on <span class="RktSym">&#946;</span> and <span class="RktSym">rec-&#946;</span>
redex configurations:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">y</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">y</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'((y y2890) (z z2891))</span></p></td></tr></table></blockquote><p>Now, because we have overridden the meaning of states, we really want
to compute an extension, not of <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span>, but of <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span>
<span class="emph">using</span> <span class="RktSym">alloc*</span>; otherwise there will be failure to match errors
because of the mismatch between <span class="RktSym">alloc</span> and <span class="RktSym">PCF&#963;*</span>.  In
other words, we want to compute an extension of <span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="stt"> </span><span class="RktSym">alloc*</span><span class="RktPn">)</span>.  And because we&rsquo;re likely to want to extend <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span>
further, we similarly abstract over the allocation metafunction again
using <span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span>, thus arriving at the following code:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Eval</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ev-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ev-app</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Continue</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">co-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">C_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">co-app</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>And now we can verify the running example yet again:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(120)</span></p></td></tr></table></blockquote><p>It&rsquo;s straightforward to observe that <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span> and
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span> operate in lock-step starting the same initial
configuration.</p><blockquote class="SubFlow"><p><a name="(counter._(exercise._eqv-store-ptr))"></a><span style="font-weight: bold">Exercise</span>&nbsp;2. Formulate and test an equivalence invariant
between <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span> and <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span>. &#9632;</p></blockquote><h4>3.11<tt>&nbsp;</tt><a name="(part._.A_look_back__a_look_forward)"></a>A look back; a look forward</h4><p>We&rsquo;ve now developed a number of semantic artifacts for the
<span class="RktSym">PCF</span> language.  We&rsquo;ve seen a calculus, a type judgment, a
compositional evaluation function, a left-to-right call-by-value
reduction semantics phrased in terms of substitution and evaluation
contexts, then as a calculus of explicit substitutions, and later as a
series of related abstract machines that model computation at a lower
and lower level, concluding with a heap-based machine that allocates
bindings and continuations.</p><p>While the path taken has anticipated the upcoming AAM steps, we have
tread a well-worn path from high-level semantics to low-level machines
using only standard semantics engineering steps.  In other words,
everything we&rsquo;ve done so far should be accessible to anyone with basic
training in programming language syntax and semantics. A PhD in static
analysis has not proved necessary.  And this is the point of AAM: to
close the gap between semantics and analysis so that deep training and
specialization in static analysis is not needed.  Instead, if you can
understand a language semantics, you should be able to construct a
program analyzer.  Moreover, you should be able to import ideas from
the interpretation of programs into the analysis of programs
<span class="emph">tout de suite</span>.</p><h3>4<tt>&nbsp;</tt><a name="(part._.Approximating_interpretation)"></a>Approximating interpretation</h3><p>Program analysis is the science of predicting program behavior.  If
you open almost any classic textbook on the subject, you&rsquo;ll find
descriptions such as this (emphasis added):</p><blockquote><p><span style="font-style: italic">[Program] analysis is a tool for discovering properties of the
run-time behavior of a program <span style="font-weight: bold">without actually running it</span><span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Steven._.S..._.Muchnick._and._.Neil._.D..._.Jones.Program._.Flow._.Analysis~3a._.Theory._and._.Applications.Prentice._.Hall1981%29" class="AutobibLink" data-pltdoc="x">Muchnick and Jones</a> <a href="index.html#%28autobib._.Steven._.S..._.Muchnick._and._.Neil._.D..._.Jones.Program._.Flow._.Analysis~3a._.Theory._and._.Applications.Prentice._.Hall1981%29" class="AutobibLink" data-pltdoc="x">1981</a>)</span>.</span></p></blockquote><p>This is partly on the mark: program analysis is about discovering what
happens when a program is run.  Exactly what we want to discover
depends on the particular application we have in mind.  Perhaps we
want to know if the program causes an error, or leaks your contacts to
spammers, or whether a particular piece of code is dead, or to which
arguments are a particular function applied, etc.</p><p>But why should we do this <span style="font-style: italic"><span style="font-weight: bold">without</span></span> running the program?
Isn&rsquo;t that the most straightforward way to discover such properties?</p><p>Well, there are a number of problems with just running a program; two
prominent ones are (1) maybe it doesn&rsquo;t terminate, and (2) maybe we
want to consider <span class="emph">all</span> possible executions of a program, not just one.</p><p>These problems have motivated long and varied lines of research in
ways of discovering program properties through means other than
running programs.  Examples include constraint-based analysis, the
monotone data-flow analysis framework, type inference systems (often
formulated in terms of constraint systems), and many more.  The common
theme to this approaches is to take programs and map them into some
alternative domain, usually losing some information, and then reason
about them in that setting, totally detached from notions of &ldquo;running
the program.&rdquo;</p><p>For example, one approach to discovering if an untyped program does
not have the property &ldquo;causes a run-time type-error,&rdquo; we could
design a language of types; define a typing relation between programs
and types; prove soundness of the relation, meaning programs in the
relation do not cause run-time errors; since in most cases the typing
relation will not be algorithmic, define a language of type
constraints and a mapping from programs to type constraints; design a
resolution method for solving type constraints and prove it complete
(or maybe not).  All this, only to discover many programs can&rsquo;t be
proved safe this way, so refine the type system, rinse and repeat.</p><p>And despite all the hard work invested in getting away from evaluation
and into some other domain (but then <span class="emph">post-facto</span> establishing a
connection because, after all, we&rsquo;re trying to predict something about
evaluation), in the end what are you computing other than an indirect,
encoded, and approximate variation of evaluation?  This is why Patrick
and Radhia Cousot have been so successful in showing every kind of
program analysis under the sun is a kind of <span class="emph">abstract</span>
interpretation.  What else could it be?</p><p>So if program analysis, however disguised, is computing something
similar to the interpreter of a language, why can&rsquo;t we design program
analyzers to look more like interpreters?  Why can&rsquo;t we leverage what
we know about building interpreters to build analyzers?  And why can&rsquo;t
we make program analyzers that are obviously correct by avoiding the
errors and effort that come with navigating a significant departure
from the running of programs.</p><p>But what about the problems of termination, etc.?  Yes, these still
exist, but we can attack them directly.  In this part of the tutorial,
we&rsquo;ll see how to take an interpreter, in the form of abstract machine,
and turn it into another machine that is a sound and computable
approximation of the interpreter.  This <span class="emph">abstract</span> abstract
machine will always terminate and always give sound predictions for
all possible executions of the program.</p><blockquote><p><span style="font-style: italic">We will discover properties of the run-time behavior of a program
<span style="font-weight: bold">by actually running it (approximately).</span></span></p></blockquote><h4>4.1<tt>&nbsp;</tt><a name="(part._.Abstracting_over__)"></a>Abstracting over <span class="RktSym">&#931;</span></h4><p>With <span class="RktSym">PCF&#963;*</span>, we had a machine with heap-bound bindings and
continuations.  One of the key mechanisms for turning a concrete
semantics into a computable, approximating semantics is to bound the
size of this heap.  As we&rsquo;ll see, doing this requires using a different
notion of a heap (an &ldquo;abstract&rdquo; heap).</p><p>So our next step will be an abstraction of the <span class="RktSym">PCF&#963;*</span> machine
to factor out the signature of heaps as an abstract data type.  We do
this by a syntactic abstraction over the signature of heaps, namely
the <span class="RktSym">ext</span> and <span class="RktSym">lookup</span> operations (recall that we&rsquo;ve
already abstracted over allocations functions).</p><p>To start, we have to go back to <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span> and abstract it as
follows:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._context-closure%29%29" class="RktStxLink" data-pltdoc="x">context-closure</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._hole%29%29" class="RktStxLink" data-pltdoc="x">hole</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">discard-&#931;-N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">discard-&#931;-O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#961;-x</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#946;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_f</span><span class="hspace">&nbsp;</span><span class="RktSym">A_f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A_f</span><span class="hspace">&nbsp;</span><span class="RktSym">f</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A_f</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">rec-&#946;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><div class="SIntrapara">It&rsquo;s easy to recreate and test our previous relations and abstractions:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></blockquote></div></p><p>Next, we abstract <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">...</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Eval</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">S_0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ev-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">S</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ev-app</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">Continue</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">co-if</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">C_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">V_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">C_0</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">co-app</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>And recreate and test:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">ext</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></blockquote><h4>4.2<tt>&nbsp;</tt><a name="(part._.Set-based_heap)"></a>Set-based heap</h4><p>It&rsquo;s now easy to construct new implementations of heaps and use them
to define new relations.  For example, here is an implementation that
models a heap as a Racket hash table that maps keys to <span class="emph">sets</span> of
values.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mode</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:contract</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">lookup-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="hspace">&nbsp;</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">lookup-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="hspace">&nbsp;</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v</span><span class="hspace">&nbsp;</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._set-~3elist%29%29" class="RktValLink" data-pltdoc="x">set-&gt;list</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" class="RktValLink" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_k</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">'</span><span class="RktVal">(</span><span class="RktVal">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">ext-&#931;1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">any</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;1</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any_k</span><span class="hspace">&nbsp;</span><span class="RktSym">any_v</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-set%29%29" class="RktValLink" data-pltdoc="x">hash-set</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_k</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._set-add%29%29" class="RktValLink" data-pltdoc="x">set-add</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash-ref%29%29" class="RktValLink" data-pltdoc="x">hash-ref</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_k</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._set%29%29" class="RktValLink" data-pltdoc="x">set</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any_v</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">REDEX</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">any</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">any</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="hspace">&nbsp;</span><span class="RktSym">any_kv0</span><span class="hspace">&nbsp;</span><span class="RktSym">any_kv1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">ext-&#931;1</span><span class="hspace">&nbsp;</span><span class="RktSym">any_r</span><span class="hspace">&nbsp;</span><span class="RktSym">any_kv0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">any_kv1</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;&#8709;</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/hashtables.html#%28def._%28%28quote._~23~25kernel%29._hash%29%29" class="RktValLink" data-pltdoc="x">hash</a></span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></blockquote><p>We have to extend the <span class="RktSym">PCF&#963;*</span> language to reflect our change in
the representation of heaps:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;*</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/stx-patterns.html#%28form._%28%28lib._racket%2Fprivate%2Fmisc..rkt%29._define-syntax-rule%29%29" class="RktStxLink" data-pltdoc="x">define-syntax-rule</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;&#8728;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%2Fextension%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction/extension</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alloc*</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;&#8728;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Finally, we define <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;&#8728;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">inj&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;&#8709;</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._test--~3e~3e%29%29" class="RktStxLink" data-pltdoc="x">test--&gt;&gt;</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">120</span><span class="RktPn">)</span></td></tr></table></blockquote><p>It&rsquo;s important to note that <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span> computes exactly what
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span> does, just with a different representation.  Everwhere
that you see a heap binding <span class="RktRes">x</span> to <span class="RktRes">v</span>, in
the <span class="RktSym">PCF&#963;*</span> state, you&rsquo;ll see an association <span class="RktRes">(x<span class="stt"> </span>v)</span>, whereas in the <span class="RktSym">PCF&#963;&#8728;</span> state, you&rsquo;ll see a hash table
mapping <span class="RktRes">x</span> to the singleton set containing
<span class="RktRes">v</span>.</p><h4>4.3<tt>&nbsp;</tt><a name="(part._.Make_it_finite)"></a>Make it finite</h4><p>One way to make the interpretation of a program computable is to make
the space of program states finite.  Think about this way, when
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span> (or equivalently, <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span>) runs forever
interpreting a program, it must be exploring an infinite subset of the
domain <span class="RktSym">&#963;*</span>.  We could design an approximation of
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;*</span> that operates on a finite approximation of
<span class="RktSym">&#963;*</span>.  If the approximation of <span class="RktSym">&#963;*</span> is finite, there&rsquo;s
no way a program can run forever since there is no infinite subset of
the finite approximation of <span class="RktSym">&#963;*</span>.</p><p>In this section, we&rsquo;ll develop such a finite approximation.</p><p>First, let&rsquo;s reflect how the running of a program could explore an
infinite subset of <span class="RktSym">&#963;*</span>.  There are only two ways, in fact: it
could allocate an unbounded amount of memory, it could compute an
arbitrarily large number.  So to bound the running of a program, we
need only bound its memory and its numbers.</p><p>This is one of the advantage of <span class="RktSym">PCF&#963;*</span>, and indeed why it was
designed as such.  The other languages have more sources of unbounded
behavior: a <span class="RktSym">PCF&#963;</span> program could grow the stack without bound,
a <span class="RktSym">PCF&#961;</span> program could create an unbounded number of closures,
and a <span class="RktSym">PCF</span> program could create an unbounded number of terms
that don&rsquo;t appear in the source program due to substitution.  In
contrast, every stack frame and closure is accounted for in the heap
of a <span class="RktSym">PCF&#963;*</span> program.  With the exception of numbers, no
expression ever arises in the running of a program that doesn&rsquo;t exist
in the source of the program.</p><p>So to tame <span class="RktSym">PCF&#963;*</span> programs, we must tame numbers and memory.
Let&rsquo;s tackle numbers first.  How could a <span class="RktSym">PCF&#963;*</span> program
generate an infinite number of numbers?  Only by an unbounded number
of applications of primitive operations.  Let&rsquo;s introduce an
abstraction of numbers.  We&rsquo;ll use a particularly coarse abstraction
here, but any sound, finite abstraction would work (e.g. we could use
a domain of signs).  Here is our abstraction:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-extended-language%29%29" class="RktStxLink" data-pltdoc="x">define-extended-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;&#8728;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._~3a~3a~3d%29%29" class="RktStxLink" data-pltdoc="x">::=</a></span><span class="hspace">&nbsp;</span><span class="RktSym">....</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>That is, we extend the set of numbers to include a new number called
<span class="RktSym">num</span>, which should be interpreted as representing <span class="emph">any</span>
number.  Having introduced this abstraction, we now provide an
alternative interpretation of primitive operations that always
produces <span class="RktSym">num</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-judgment-form%29%29" class="RktStxLink" data-pltdoc="x">define-judgment-form</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:mode</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;^</span><span class="hspace">&nbsp;</span><span class="RktSym">I</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">#:contract</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#948;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N_0</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#948;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Moving on to the taming memory, we will replace the allocation
function with an alternative that only produces a <span class="emph">finite</span> set of
addresses.  We could choose any strategy for finitizing the allocation
function, and the particular strategy you choose will have major
consequences for the program analysis you construct.  One simple
method for finitizing allocation is to <span class="emph">truncate</span> the results of
<span class="RktSym">alloc&#8728;</span> to a single symbol.  In the case of variable bindings
this symbol will just be the name of the variable.  Consequently, the
approximation we compute will be what&rsquo;s known as a
<a name="(tech._monovariant)"></a><span style="font-style: italic">monovariant</span> analysis:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%2Fextension%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction/extension</a></span><span class="hspace">&nbsp;</span><span class="RktSym">alloc&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc&#8728;^</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">alloc^</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">alloc^</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">_</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">alloc&#8728;^</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Besides primitive operations, there&rsquo;s one other consumer of numbers:
the conditional form <span class="RktSym">if0</span>.  We want to design the semantics of
<span class="RktSym">if0</span> in combination with the abstraction <span class="RktSym">num</span> so that
it covers all behavior abstracted by <span class="RktSym">num</span>.  Since a number may
be zero or non-zero, we add cases to the reduction relation to take
both branches when a conditional encounters <span class="RktSym">num</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._extend-reduction-relation%29%29" class="RktStxLink" data-pltdoc="x">extend-reduction-relation</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;/&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">alloc^</span><span class="hspace">&nbsp;</span><span class="RktSym">ext-&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">lookup-&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">N_1</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._judgment-holds%29%29" class="RktStxLink" data-pltdoc="x">judgment-holds</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#948;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">N_1</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">&#948;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">if0-num-t</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._--~3e%29%29" class="RktStxLink" data-pltdoc="x"><span class="nobreak">--&gt;</span></a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym">C_1</span><span class="hspace">&nbsp;</span><span class="RktSym">C_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C_2</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">if0-num-f</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p><div class="SIntrapara">Notice that now the reduction relation is truly a relation and not a
function; some terms have multiple successors:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="hspace">&nbsp;</span><span class="RktVal">2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1 2)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Now when we abstractly run our example, we see that results include
<span class="RktSym">num</span>:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'(1 num)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Here&rsquo;s another example that shows the approximation in bindings.
Notice that <span class="RktVar">z</span> is bound to both <span class="RktVal">0</span> and <span class="RktVal">1</span>, so
both are given as possible results for this program:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktVal">0</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">f</span><span class="hspace">&nbsp;</span><span class="RktVal">1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">z</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">z</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'(0 1)</span></p></td></tr></table></blockquote></div></p><p><div class="SIntrapara">Here&rsquo;s an example where we can see that <span class="RktRes">&#937;</span> does not
terminate; thus the analysis proves non-termination for this program:
</div><div class="SIntrapara"><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#937;</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote></div></p><blockquote class="SubFlow"><p><a name="(counter._(exercise._approx))"></a><span style="font-weight: bold">Exercise</span>&nbsp;3. Develop an &ldquo;approximation&rdquo; relation between
concrete states (<span class="RktSym">PCF&#963;&#8728;</span>) and abstract states (<span class="RktSym">PCF&#963;^</span>)
and then formulate and test an invariant that states any concrete
reduction implies the existence of a abstract reduction. &#9632;</p></blockquote><h4>4.4<tt>&nbsp;</tt><a name="(part._.Soundness)"></a>Soundness</h4><p>We have aimed to construct a new semantics (<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span>) that is a
<span class="emph">sound</span> and <span class="emph">computable</span> approximation of the original
abstract machine semantics (<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span>).  The computability
argument is simple: starting from an initial configuration, there are
only a finite set of states that can be reached.  You can check this
yourself by going through each category of the state space to observe
that there are only a finite number of elements, assuming the
<span class="RktSym">alloc^</span> function only returns elements drawn from a finite
set.</p><p>The soundness argument is also simple: every time the concrete machine
<span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;&#8728;</span> takes a step from one state <span class="RktVar">&#963;_1</span> to
<span class="RktVar">&#963;_2</span>, then starting from a corresponding abstract state that
approximates <span class="RktVar">&#963;_1</span>, the <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span> machine steps to a
state that approximates <span class="RktVar">&#963;_2</span>.  It may also step to other
states&#8212;<wbr></wbr>such is the nature of approximation&#8212;<wbr></wbr>but at least one of the
successor states will be an approximation of the &ldquo;real&rdquo; successor.
Consequently, while the concrete machines reduction may produce an
infinite trace of states, that infinite trace will follow a path
through the finite graph of the abstract reduction graph.</p><p>We can formalize this observation by first defining what it means for
a concrete state to be approximated by an abstract one.  We do so with
a relation, <span class="RktSym">&#8849;&#963;</span>, which relates concrete and abstract states:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">&#8849;&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8838;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#215;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#963;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#963;</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="hspace">&nbsp;</span><span class="RktSym">V_2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktSym">V_1</span><span class="hspace">&nbsp;</span><span class="RktSym">V_2</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#963;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#962;_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#962;_2</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#962;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#962;_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#962;_2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_2</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>As you can see, this depends on notions of approximation for each
sub-component of a machine state.  The remaining definitions are
straightforward by structural recursion, with the exception of
values, addresses, environments, and stores.</p><p>Approximation for values is simple; the interesting case is the base
case that takes of abstract values <span class="RktSym">num</span>.</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8838;</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktSym">&#215;</span><span class="hspace">&nbsp;</span><span class="RktSym">V</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="hspace">&nbsp;</span><span class="RktSym">N</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="hspace">&nbsp;</span><span class="RktSym">O</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">L</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_2</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">L</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;_2</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Approximation for addresses follows from our choice of <span class="RktSym">alloc*</span>
and <span class="RktSym">alloc^</span>:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">&#8849;A</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8838;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span><span class="hspace">&nbsp;</span><span class="RktSym">&#215;</span><span class="hspace">&nbsp;</span><span class="RktSym">A</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;A</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">F_1</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">F_2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;F</span><span class="hspace">&nbsp;</span><span class="RktSym">F_1</span><span class="hspace">&nbsp;</span><span class="RktSym">F_2</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>Notice that a concrete address is approximated by an abstract one if
truncating the unique part of a concrete address obtains the abstract
counterpart.</p><p>Environments, which are finite maps, are defined by the usual notion
of inclusion for maps, combined with approximation in the range:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">&#8849;&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8838;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#215;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X_0</span><span class="hspace">&nbsp;</span><span class="RktSym">A_0</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">A_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">name</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_0</span><span class="hspace">&nbsp;</span><span class="RktSym">A_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">_</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;A</span><span class="hspace">&nbsp;</span><span class="RktSym">A_0</span><span class="hspace">&nbsp;</span><span class="RktSym">A_2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#961;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">A_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#961;</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>This gives a clue as to how to define approximation for stores, too,
but with two added complications: approximation must be used in the
domain as well as the range and we have used a non-s-expression based
representation.  The later means we cannot use Redex&rsquo;s pattern
matching language to define the relation and instead escape to Racket:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-relation%29%29" class="RktStxLink" data-pltdoc="x">define-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">&#8849;&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#8838;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#215;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">&#8849;&#931;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_1</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktVal">#t</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Fand%29%29" class="RktStxLink" data-pltdoc="x">for/and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktSym">us</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-hash%29%29" class="RktValLink" data-pltdoc="x">in-hash</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2Fand%29%29" class="RktStxLink" data-pltdoc="x">for/and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">u</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._in-set%29%29" class="RktValLink" data-pltdoc="x">in-set</a></span><span class="hspace">&nbsp;</span><span class="RktSym">us</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2For%29%29" class="RktStxLink" data-pltdoc="x">for/or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">a^</span><span class="hspace">&nbsp;</span><span class="RktSym">us^</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sequences.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._in-hash%29%29" class="RktValLink" data-pltdoc="x">in-hash</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/for.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._for%2For%29%29" class="RktStxLink" data-pltdoc="x">for/or</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">u^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._in-set%29%29" class="RktValLink" data-pltdoc="x">in-set</a></span><span class="hspace">&nbsp;</span><span class="RktSym">us^</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/if.html#%28form._%28%28lib._racket%2Fprivate%2Fletstx-scheme..rkt%29._and%29%29" class="RktStxLink" data-pltdoc="x">and</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;A</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">a^</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#8849;U</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">u</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktSym">u^</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><h4>4.5<tt>&nbsp;</tt><a name="(part._.Discovering_properties)"></a>Discovering properties</h4><p>At this point, we have a sound and computable approximation to the
machine semantics for PCF.  Since we know the machine semantics
corresponds with all the earlier higher-level semantics, we have a
computable approximation to them as well.  But what can we do with
such a thing?</p><p>In general, program analysis is concerned with making sound
predictions about what can happen at run-time, and we are now in a
position to make such predictions.  The way to think about these
predictions is to think of the (finite) graph generated by the
iterated application of <span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span>.  Each state of this machine
stands for a set (which is potentially an infinite set) of
&ldquo;concrete&rdquo; machine states.</p><p>If a concrete machine state is not &ldquo;stood for&rdquo; in the abstract
graph, then it cannot be reached when the program is run.  We saw a
simple example of this earlier: the program <span class="RktVar">&#937;</span> never reaches
a final value state in the abstract, therefore we can conclude that it
never finishes when concretely run either.</p><p>By looking at the abstract semantics of <span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="stt"> </span><span class="RktSym">fact-5</span><span class="RktPn">)</span> we can
conclude that if it produces a value, it produces a number.  This is
confirming a fact implied by the type of the program.  Suppose we were
instead dealing with an untyped language, this analysis would have
proven the run-time type safety of the program.</p><p>We can confirm this by running (an ill-typed) program and seeing that
there are stuck states in the abstract trace.  Here&rsquo;s a variant of the
factorial program that produces a function in the base case instead of
a number:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5-bug</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fact</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">add1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fact</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/define.html#%28form._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._define%29%29" class="RktStxLink" data-pltdoc="x">define</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">final-states</span><span class="hspace">&nbsp;</span><span class="RktSym">ss</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._set-~3elist%29%29" class="RktValLink" data-pltdoc="x">set-&gt;list</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/sets.html#%28def._%28%28lib._racket%2Fset..rkt%29._list-~3eset%29%29" class="RktValLink" data-pltdoc="x">list-&gt;set</a></span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fmap..rkt%29._map%29%29" class="RktValLink" data-pltdoc="x">map</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term-match%2Fsingle%29%29" class="RktStxLink" data-pltdoc="x">term-match/single</a></span><span class="hspace">&nbsp;</span><span class="RktSym">PCF&#963;^</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">C</span><span class="hspace">&nbsp;</span><span class="RktSym">K</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">&#931;</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">C</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktSym">V</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">V</span><span class="RktPn">)</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktSym">ss</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">final-states</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5-bug</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'((* 5 add1) (* num add1) add1)</span></p></td></tr></table></blockquote><p>Here we used a small helper function to extract the stuck inner
expression or final values and produce a set of irreducible terms.</p><p>As you can see, this program either doesn&rsquo;t get stuck and produces
<span class="RktSym">add1</span>, or it gets stuck trying to multiply a number by
<span class="RktSym">add1</span>.</p><p>We can also verify the safety of programs rejected by typical type
systems.  For example, this program never produces a run-time type
error (because it loops), but is ill-typed according to the <span class="RktSym">&#8866;</span>
judgment:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">safe</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">&#937;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktVal">5</span><span class="hspace">&nbsp;</span><span class="RktVal">7</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">add1</span><span class="hspace">&nbsp;</span><span class="RktSym">add1</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym">final-states</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._apply-reduction-relation%2A%29%29" class="RktValLink" data-pltdoc="x">apply-reduction-relation*</a></span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">--&gt;</span>v&#963;^</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">inj&#963;&#8728;</span><span class="hspace">&nbsp;</span><span class="RktSym">safe</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><p><span class="RktRes">'()</span></p></td></tr></table></blockquote><p>Note that this program never reaches a stuck state.</p><p>Moreover, we are given much more detail about what happens at run-time
compared to a typical type system.  Suppose we had instead written
this buggy factorial function that messes up the base case:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-term%29%29" class="RktStxLink" data-pltdoc="x">define-term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">fact-5-zero</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fact</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">num</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktVal">0</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">*</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">fact</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">sub1</span><span class="hspace">&nbsp;</span><span class="RktSym">n</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktVal">5</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote><p>By inspecting the trace graph for this program, it&rsquo;s easy to see that
all final states are either <span class="RktVal">0</span> or involve a multiplication by
<span class="RktVal">0</span>.  Thus we can safely predict that if this program produces
a result, it will be zero.</p><p>We can recast classic forms of program analysis in the AAM setting.
For example, higher-order control flow analysis is understood as the
process of predicting, for each application in a program, which lambda
term could be applied (i.e. where can control transfer to at that
point).  It&rsquo;s easy to compute this analysis from the abstract trace
graph: for each reachable application, the next state will be a push
to the stack, putting the function expression in the control string
position.  Any lambda term which could be applied is just the set of
functions reachable from this state with the same stack.  So we can
read off CFA results from the graph.  Temporal properties can also be
discovered by examing the graph.  For example, imagining we carried
out the AAM recipe for a richer language that included file I/O, we
could verify files are always opened before written to, closed only
after opening, and never double-closed.</p><h3>5<tt>&nbsp;</tt><a name="(part._.Going_further)"></a>Going further</h3><p>You have now seen the basics of semantic modelling in Redex and the
AAM approach to designing sound and computable approximations to
program behavior.  This tutorial has only touched on the basics, but
it&rsquo;s possible to go much further with both.</p><h4>5.1<tt>&nbsp;</tt><a name="(part._.Going_further_with_.Redex)"></a>Going further with Redex</h4><p>Redex also includes features for property-based random testing, which
have not been covered here.  These features are great for testing
formal claims about semantics in a lightweight way.  It&rsquo;s often a
useful first step before trying to <span class="emph">prove</span> something about your
semantics.</p><p>Redex also has features for typesetting your semantics.  For example,
you can render reduction relations, judgments, etc.:</p><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Fpict..rkt%29._render-reduction-relation%29%29" class="RktValLink" data-pltdoc="x">render-reduction-relation</a></span><span class="hspace">&nbsp;</span><span class="RktSym">r</span><span class="RktPn">)</span></td></tr><tr><td><p><img style="vertical-align: -3.3017578125px; margin: -3px -3px -3px -3px;" src="pict.png" alt="image" width="208.203125" height="265.1435546875"/></p></td></tr></table></blockquote><p>These features enable you to typeset a paper directly from a Redex
model, avoiding the tedious work and possibility of introducing errors
by transliterating to LaTeX.  You can export PDF or PS figures or you
can write your entire article in Racket&rsquo;s Scribble language, which was
used to prepare this document.</p><p>It&rsquo;s also possible to take advantage of many of the other features in
the Racket toolkit for designing languages.  For example, it&rsquo;s pretty
easy to turn a Redex model into a &ldquo;<span class="stt">#lang</span>&rdquo; language,
integrating it in to the IDE and giving users a REPL for interacting
with the model.  Once you have a <span class="stt">#lang</span> version of your model,
it&rsquo;s easy to deploy web REPL to make online demos and interactive
documentation.</p><p>For more details on Redex, see the Redex book<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009%29" class="AutobibLink" data-pltdoc="x">Felleisen et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Matthias._.Felleisen%2C._.Robert._.Bruce._.Findler%2C._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009%29" class="AutobibLink" data-pltdoc="x">2009</a>)</span> and
docs.  For a paper with several case studies developing models drawn
from published papers, see the <span class="emph">Run Your Research</span>
paper<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Casey._.Klein%2C._.John._.Clements%2C._.Christos._.Dimoulas%2C._.Carl._.Eastlund%2C._.Matthias._.Felleisen%2C._.Matthew._.Flatt%2C._.Jay._.A..._.Mc.Carthy%2C._.Jon._.Rafkind%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Robert._.Bruce._.Findler.Run._.Your._.Research~3a._.On._the._.Effectiveness._of._.Lightweight._.Mechanization.In._.Proc..._.The._39th._.Annual._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T~0a.Symposium._on._.Principles._of._.Programming._.Languages._%28.P.O.P.L%292012%29" class="AutobibLink" data-pltdoc="x">Klein et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Casey._.Klein%2C._.John._.Clements%2C._.Christos._.Dimoulas%2C._.Carl._.Eastlund%2C._.Matthias._.Felleisen%2C._.Matthew._.Flatt%2C._.Jay._.A..._.Mc.Carthy%2C._.Jon._.Rafkind%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Robert._.Bruce._.Findler.Run._.Your._.Research~3a._.On._the._.Effectiveness._of._.Lightweight._.Mechanization.In._.Proc..._.The._39th._.Annual._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T~0a.Symposium._on._.Principles._of._.Programming._.Languages._%28.P.O.P.L%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>)</span>.  For examples of papers developed
completely in Scribble and Redex, see <span class="emph">Gradual Typing for
First-Class Classes</span><span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Asumu._.Takikawa%2C._.T..._.Stephen._.Strickland%2C._.Christos._.Dimoulas%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Matthias._.Felleisen.Gradual._.Typing._for._.First-.Class._.Classes.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292012%29" class="AutobibLink" data-pltdoc="x">Takikawa et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Asumu._.Takikawa%2C._.T..._.Stephen._.Strickland%2C._.Christos._.Dimoulas%2C._.Sam._.Tobin-.Hochstadt%2C._and._.Matthias._.Felleisen.Gradual._.Typing._for._.First-.Class._.Classes.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>)</span>,
<span class="emph">Constraining Delimited Control with
Contracts</span><span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Asumu._.Takikawa%2C._.T..._.Stephen._.Strickland%2C._and._.Sam._.Tobin-.Hochstadt.Constraining._.Delimited._.Control._with._.Contracts.In._.Proc..._.European._.Symposium._on._.Programming._%28.E.S.O.P%292013%29" class="AutobibLink" data-pltdoc="x">Takikawa et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Asumu._.Takikawa%2C._.T..._.Stephen._.Strickland%2C._and._.Sam._.Tobin-.Hochstadt.Constraining._.Delimited._.Control._with._.Contracts.In._.Proc..._.European._.Symposium._on._.Programming._%28.E.S.O.P%292013%29" class="AutobibLink" data-pltdoc="x">2013</a>)</span>, or the source code
for this tutorial.</p><h4>5.2<tt>&nbsp;</tt><a name="(part._.Going_futher_with_.A.A.M)"></a>Going futher with AAM</h4><p>The basic idea of AAM opens up several avenues for further research.
One is simply to scale the analysis to richer languages.  The original
<span class="emph">Abstracting Abstract Machine</span> paper<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Abstracting._.Abstract._.Machines.In._.Proc..._.The._15th._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292010%29" class="AutobibLink" data-pltdoc="x">Van Horn and Might</a> <a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Abstracting._.Abstract._.Machines.In._.Proc..._.The._15th._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292010%29" class="AutobibLink" data-pltdoc="x">2010</a>)</span> covers more
advanced language features such as mutable references, first-class
control operators, and stack inspection, and extends naturally to
handle concurrency<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Matthew._.Might._and._.David._.Van._.Horn.A._.Family._of._.Abstract._.Interpretations._for._.Static._.Analysis~0aof._.Concurrent._.Higher-.Order._.Programs.In._.Proc..._.International._.Static._.Analysis~0a.Symposium._%28.S.A.S%292011%29" class="AutobibLink" data-pltdoc="x">Might and Van Horn</a> <a href="index.html#%28autobib._.Matthew._.Might._and._.David._.Van._.Horn.A._.Family._of._.Abstract._.Interpretations._for._.Static._.Analysis~0aof._.Concurrent._.Higher-.Order._.Programs.In._.Proc..._.International._.Static._.Analysis~0a.Symposium._%28.S.A.S%292011%29" class="AutobibLink" data-pltdoc="x">2011</a>)</span>. Subsequent research
based on AAM has applied the technique to Javascript<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Vineeth._.Kashyap%2C._.Kyle._.Dewey%2C._.Ethan._.A..._.Kuefner%2C._.John._.Wagner%2C._.Kevin._.Gibbons%2C._.John._.Sarracino%2C._.Ben._.Wiedermann%2C._and._.Ben._.Hardekopf.J.S.A.I~3a._.A._.Static._.Analysis._.Platform._for._.Java.Script.In._.Proc..._.Symposium._on._.Foundations._of._.Software._.Engineering._%28.F.S.E%292014%29" class="AutobibLink" data-pltdoc="x">Kashyap et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Vineeth._.Kashyap%2C._.Kyle._.Dewey%2C._.Ethan._.A..._.Kuefner%2C._.John._.Wagner%2C._.Kevin._.Gibbons%2C._.John._.Sarracino%2C._.Ben._.Wiedermann%2C._and._.Ben._.Hardekopf.J.S.A.I~3a._.A._.Static._.Analysis._.Platform._for._.Java.Script.In._.Proc..._.Symposium._on._.Foundations._of._.Software._.Engineering._%28.F.S.E%292014%29" class="AutobibLink" data-pltdoc="x">2014</a>; <a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Pushdown._.Abstractions._of._.Java.Scriptar.Xiv%2C._109-44672011%29" class="AutobibLink" data-pltdoc="x">Van Horn and Might</a> <a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Pushdown._.Abstractions._of._.Java.Scriptar.Xiv%2C._109-44672011%29" class="AutobibLink" data-pltdoc="x">2011</a>)</span>, Dalvik (a JVM-like machine for the Android
platform)<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Shuying._.Liang%2C._.Andrew._.W..._.Keep%2C._.Matthew._.Might%2C._.Steven._.Lyde%2C._.Thomas._.Gilray%2C._.Petey._.Aldous%2C._and._.David._.Van._.Horn.Sound._and._.Precise._.Malware._.Analysis._for._.Android._via~0a.Pushdown._.Reachability._and._.Entry-.Point._.Saturation.In._.Proc..._.Third._.A.C.M._workshop._on._.Security~0aand._privacy._in._smartphones._~26._mobile._devices2013%29" class="AutobibLink" data-pltdoc="x">Liang et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Shuying._.Liang%2C._.Andrew._.W..._.Keep%2C._.Matthew._.Might%2C._.Steven._.Lyde%2C._.Thomas._.Gilray%2C._.Petey._.Aldous%2C._and._.David._.Van._.Horn.Sound._and._.Precise._.Malware._.Analysis._for._.Android._via~0a.Pushdown._.Reachability._and._.Entry-.Point._.Saturation.In._.Proc..._.Third._.A.C.M._workshop._on._.Security~0aand._privacy._in._smartphones._~26._mobile._devices2013%29" class="AutobibLink" data-pltdoc="x">2013<span class="AutobibLink">a</span></a>; <a href="index.html#%28autobib._.Shuying._.Liang%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Ana.Droid~3a._.Malware._.Analysis._of._.Android._with._.User-supplied._.Predicates.In._.Proc..._.Workshop._on._.Tools._for._.Automatic._.Program._.Analysis2013%29" class="AutobibLink" data-pltdoc="x">Liang et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Shuying._.Liang%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Ana.Droid~3a._.Malware._.Analysis._of._.Android._with._.User-supplied._.Predicates.In._.Proc..._.Workshop._on._.Tools._for._.Automatic._.Program._.Analysis2013%29" class="AutobibLink" data-pltdoc="x">2013<span class="AutobibLink">b</span></a>)</span>, and
Racket<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Sam._.Tobin-.Hochstadt%2C._and._.David._.Van._.Horn.Soft._.Contract._.Verification.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292014%29" class="AutobibLink" data-pltdoc="x">Nguy&#7877;n et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Sam._.Tobin-.Hochstadt%2C._and._.David._.Van._.Horn.Soft._.Contract._.Verification.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292014%29" class="AutobibLink" data-pltdoc="x">2014</a>; <a href="index.html#%28autobib._.Sam._.Tobin-.Hochstadt._and._.David._.Van._.Horn.Higher-.Order._.Symbolic._.Execution._with._.Contracts.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292012%29" class="AutobibLink" data-pltdoc="x">Tobin-Hochstadt and Van Horn</a> <a href="index.html#%28autobib._.Sam._.Tobin-.Hochstadt._and._.David._.Van._.Horn.Higher-.Order._.Symbolic._.Execution._with._.Contracts.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>)</span>.</p><p>Another avenue to explore is to import ideas from run-time systems
into abstract interpretation via AAM.  For example, precision is lost
in AAM whenever several values end up at the same heap location.  An
obvious idea is to incorporate a garbage collector into the machine.
The abstract garbage collector is the natural lifting of the concrete
collector for the machine with the set-based heap.  This idea improves
the precision and performance of the analysis and creates a kind of
dynamic polymorphism that would be hard to imagine under traditional
static analysis formulations such as constraint-based analyses.  In
the same vein, we can take ideas for speeding up intepretation by
writing a compiler and apply them to abstract
interpretation<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.J..._.Ian._.Johnson%2C._.Nicholas._.Labich%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Optimizing._.Abstract._.Abstract._.Machines.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International~0a.Conference._on._.Functional._.Programming._%28.I.C.F.P%292013%29" class="AutobibLink" data-pltdoc="x">Johnson et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.J..._.Ian._.Johnson%2C._.Nicholas._.Labich%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Optimizing._.Abstract._.Abstract._.Machines.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International~0a.Conference._on._.Functional._.Programming._%28.I.C.F.P%292013%29" class="AutobibLink" data-pltdoc="x">2013</a>)</span>.  We can also import ideas for the
structuring of extensible interpreters in order to structure abstract
interpreters.  For example, our abstract machine semantics is
implicitly organized around a state and non-determinism monad, which
can be made explicit<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Ilya._.Sergey%2C._.Dominique._.Devriese%2C._.Matthew._.Might%2C._.Jan._.Midtgaard%2C._.David._.Darais%2C._.Dave._.Clarke%2C._and._.Frank._.Piessens.Monadic._.Abstract._.Interpreters.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.Conference._on~0a.Programming._.Language._.Design._and._.Implementation._%28.P.L.D.I%292013%29" class="AutobibLink" data-pltdoc="x">Sergey et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Ilya._.Sergey%2C._.Dominique._.Devriese%2C._.Matthew._.Might%2C._.Jan._.Midtgaard%2C._.David._.Darais%2C._.Dave._.Clarke%2C._and._.Frank._.Piessens.Monadic._.Abstract._.Interpreters.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.Conference._on~0a.Programming._.Language._.Design._and._.Implementation._%28.P.L.D.I%292013%29" class="AutobibLink" data-pltdoc="x">2013</a>)</span>.  Going a step further, we can
use monad transformers to automatically construct abstract
interpreters out of off-the-shelf
abstractions<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.David._.Darais._and._.David._.Van._.Horn.Galois._.Transformers._and._.Modular._.Abstract._.Interpreters.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292015%29" class="AutobibLink" data-pltdoc="x">Darais and Van Horn</a> <a href="index.html#%28autobib._.David._.Darais._and._.David._.Van._.Horn.Galois._.Transformers._and._.Modular._.Abstract._.Interpreters.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292015%29" class="AutobibLink" data-pltdoc="x">2015</a>)</span>.</p><p>The basic AAM approach approximates a potential infinite-state
transition system with a finite state machine.  This is a fairly
heavy-handed way of achieving decidability and there&rsquo;s been work on
increasing the power of the abstraction model to that of pushdown system.
There have been several formulations of such an
analysis<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Christopher._.Earl%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Pushdown._.Control-.Flow._.Analysis._of._.Higher-.Order._.Programs.In._.Proc..._.Workshop._on._.Scheme._and._.Functional~0a.Programming._%28.S.F.P%292010%29" class="AutobibLink" data-pltdoc="x">Earl et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Christopher._.Earl%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Pushdown._.Control-.Flow._.Analysis._of._.Higher-.Order._.Programs.In._.Proc..._.Workshop._on._.Scheme._and._.Functional~0a.Programming._%28.S.F.P%292010%29" class="AutobibLink" data-pltdoc="x">2010</a>; <a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Systematic._.Abstraction._of._.Abstract._.Machines.Journal._of._.Functional._.Programming._22%284-5%292012%29" class="AutobibLink" data-pltdoc="x">Van Horn and Might</a> <a href="index.html#%28autobib._.David._.Van._.Horn._and._.Matthew._.Might.Systematic._.Abstraction._of._.Abstract._.Machines.Journal._of._.Functional._.Programming._22%284-5%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>; <a href="index.html#%28autobib._.Dimitris._.Vardoulakis._and._.Olin._.Shivers.C.F.A2~3a._a._.Context-.Free._.Approach._to._.Control-.Flow._.Analysis.Logical._.Methods._in._.Computer._.Science._7%282-3%292011%29" class="AutobibLink" data-pltdoc="x">Vardoulakis and Shivers</a> <a href="index.html#%28autobib._.Dimitris._.Vardoulakis._and._.Olin._.Shivers.C.F.A2~3a._a._.Context-.Free._.Approach._to._.Control-.Flow._.Analysis.Logical._.Methods._in._.Computer._.Science._7%282-3%292011%29" class="AutobibLink" data-pltdoc="x">2011<span class="AutobibLink">a</span></a>)</span>, but the basic idea is
that you skip the heap-allocated continuation step presented here and
leave the stack in place when abstracting.  It&rsquo;s not hard to see that
the resulting machine has a state that consists of finite component
(the closure and heap) and a control stack whose alphabet of stack
frames is drawn from a finite alphabet.  Since the machine always
treats the stack in a stack-like manner, i.e. it only inspects the top
element and pushes and pops single frames at a time, it forms a
pushdown automata.  Unlike the finite state abstraction, the resulting
machine always matches function calls and returns precisely.  However,
the added computational power requires different fixed-point
algorithms since iterating the transition relation may not terminate.
Care must also be taken when language features are included that don&rsquo;t
obey the stack discipline of a pushdown automaton.  For example,
garbage collection or first-class control operators may require
traversing the stack, which is not permitted in the pushdown model;
consequently, special purpose algorithms have been developed to walk
the fine line between pushdown models and decidability for control
operators<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.J..._.Ian._.Johnson._and._.David._.Van._.Horn.Abstracting._.Abstract._.Control.In._.Proc..._.A.C.M._.Symposium._on._.Dynamic~0a.Languages._%28.D.L.S%292014%29" class="AutobibLink" data-pltdoc="x">Johnson and Van Horn</a> <a href="index.html#%28autobib._.J..._.Ian._.Johnson._and._.David._.Van._.Horn.Abstracting._.Abstract._.Control.In._.Proc..._.A.C.M._.Symposium._on._.Dynamic~0a.Languages._%28.D.L.S%292014%29" class="AutobibLink" data-pltdoc="x">2014</a>; <a href="index.html#%28autobib._.Dimitris._.Vardoulakis._and._.Olin._.Shivers.Pushdown._.Flow._.Analysis._of._.First-.Class._.Control.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International~0a.Conference._on._.Functional._.Programming._%28.I.C.F.P%292011%29" class="AutobibLink" data-pltdoc="x">Vardoulakis and Shivers</a> <a href="index.html#%28autobib._.Dimitris._.Vardoulakis._and._.Olin._.Shivers.Pushdown._.Flow._.Analysis._of._.First-.Class._.Control.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International~0a.Conference._on._.Functional._.Programming._%28.I.C.F.P%292011%29" class="AutobibLink" data-pltdoc="x">2011<span class="AutobibLink">b</span></a>)</span> and GC<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Christopher._.Earl%2C._.Ilya._.Sergey%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Introspective._.Pushdown._.Analysis._of._.Higher-.Order._.Programs.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292012%29" class="AutobibLink" data-pltdoc="x">Earl et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Christopher._.Earl%2C._.Ilya._.Sergey%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Introspective._.Pushdown._.Analysis._of._.Higher-.Order._.Programs.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>; <a href="index.html#%28autobib._.J..._.Ian._.Johnson%2C._.Ilya._.Sergey%2C._.Christopher._.Earl%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Pushdown._flow._analysis._with._abstract._garbage._collection.Journal._of._.Functional._.Programming._24%282--3%292014%29" class="AutobibLink" data-pltdoc="x">Johnson et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.J..._.Ian._.Johnson%2C._.Ilya._.Sergey%2C._.Christopher._.Earl%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Pushdown._flow._analysis._with._abstract._garbage._collection.Journal._of._.Functional._.Programming._24%282--3%292014%29" class="AutobibLink" data-pltdoc="x">2014</a>)</span>.  Recently, a simple algorithm for pushdown CFA has been
developed whose time complexity is cubic when using an abstract
allocation strategy like the one used in these notes, which is the
same complexity as the best finite state
algorithm<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Thomas._.Gilray%2C._.Steven._.Lyde%2C._.Michael._.D..._.Adams%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Pushdown._.Control-.Flow._.Analysis._for._.Free.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T._.Symposium._on~0a.Principles._in._.Programming._.Languages._%28.P.O.P.L%292016%29" class="AutobibLink" data-pltdoc="x">Gilray et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Thomas._.Gilray%2C._.Steven._.Lyde%2C._.Michael._.D..._.Adams%2C._.Matthew._.Might%2C._and._.David._.Van._.Horn.Pushdown._.Control-.Flow._.Analysis._for._.Free.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T._.Symposium._on~0a.Principles._in._.Programming._.Languages._%28.P.O.P.L%292016%29" class="AutobibLink" data-pltdoc="x">2016</a>)</span>.</p><p>The AAM approach starts from a machine semantics and produces a
computable abstraction to predict the behavior that arises at
run-time.  As such, it produces a <span class="emph">whole-program</span> analysis.  It
may seem that the approach is fundamentally at odds with a modular
analysis since it&rsquo;s so closely tied to the machine semantics, which
are necessarily (it would seem) defined for whole programs.  Modular
higher-order flow analyses are few and far
between<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Cormac._.Flanagan._and._.Matthias._.Felleisen.Componential._set-based._analysis.Componential._set-based._analysis._21%282%291999%29" class="AutobibLink" data-pltdoc="x">Flanagan and Felleisen</a> <a href="index.html#%28autobib._.Cormac._.Flanagan._and._.Matthias._.Felleisen.Componential._set-based._analysis.Componential._set-based._analysis._21%282%291999%29" class="AutobibLink" data-pltdoc="x">1999</a>; <a href="index.html#%28autobib._.Olin._.Shivers.Control-.Flow._.Analysis._of._.Higher-.Order._.Languages.Ph.D._dissertation%2C._.Carnegie._.Mellon._.University1991%29" class="AutobibLink" data-pltdoc="x">Shivers</a> <a href="index.html#%28autobib._.Olin._.Shivers.Control-.Flow._.Analysis._of._.Higher-.Order._.Languages.Ph.D._dissertation%2C._.Carnegie._.Mellon._.University1991%29" class="AutobibLink" data-pltdoc="x">1991</a>)</span> in part because
analyzing incomplete programs is difficult since behavioral values may
escape to or be provided by the unknown, external world.  However, the
AAM approach can be extended to perform modular analysis.  Rather than
solving the modularity problem <span class="emph">after</span> abstraction, an
alternative approach is to construct a concrete semantics of modular
(or incomplete) programs<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Thomas._.Gilray%2C._.Sam._.Tobin-.Hochstadt%2C._and._.David._.Van._.Horn.Soft._.Contract._.Verification._for._.Higher-order._.Stateful._.Programs.In._.Proc..._.The._45th._.A.C.M._.S.I.G.P.L.A.N._.Symposium._on._.Principles._of._.Programming._.Languages._%28.P.O.P.L%292018%29" class="AutobibLink" data-pltdoc="x">Nguy&#7877;n et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Thomas._.Gilray%2C._.Sam._.Tobin-.Hochstadt%2C._and._.David._.Van._.Horn.Soft._.Contract._.Verification._for._.Higher-order._.Stateful._.Programs.In._.Proc..._.The._45th._.A.C.M._.S.I.G.P.L.A.N._.Symposium._on._.Principles._of._.Programming._.Languages._%28.P.O.P.L%292018%29" class="AutobibLink" data-pltdoc="x">2018</a>; <a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Sam._.Tobin-.Hochstadt%2C._and._.David._.Van._.Horn.Soft._.Contract._.Verification.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292014%29" class="AutobibLink" data-pltdoc="x">Nguy&#7877;n et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Sam._.Tobin-.Hochstadt%2C._and._.David._.Van._.Horn.Soft._.Contract._.Verification.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292014%29" class="AutobibLink" data-pltdoc="x">2014</a>; <a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n._and._.David._.Van._.Horn.Relatively._.Complete._.Counterexamples._for._.Higher-.Order._.Programs.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.Conference._on._.Programming._.Language._.Design._and._.Implementation._%28.P.L.D.I%292015%29" class="AutobibLink" data-pltdoc="x">Nguy&#7877;n and Van Horn</a> <a href="index.html#%28autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n._and._.David._.Van._.Horn.Relatively._.Complete._.Counterexamples._for._.Higher-.Order._.Programs.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.Conference._on._.Programming._.Language._.Design._and._.Implementation._%28.P.L.D.I%292015%29" class="AutobibLink" data-pltdoc="x">2015</a>; <a href="index.html#%28autobib._.Sam._.Tobin-.Hochstadt._and._.David._.Van._.Horn.Higher-.Order._.Symbolic._.Execution._with._.Contracts.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292012%29" class="AutobibLink" data-pltdoc="x">Tobin-Hochstadt and Van Horn</a> <a href="index.html#%28autobib._.Sam._.Tobin-.Hochstadt._and._.David._.Van._.Horn.Higher-.Order._.Symbolic._.Execution._with._.Contracts.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming%2C._.Systems%2C._.Languages._and~0a.Applications._%28.O.O.P.S.L.A%292012%29" class="AutobibLink" data-pltdoc="x">2012</a>)</span> and then run through the usual AAM steps to obtain a
modular abstract interpreter.</p><p>For a different perspective, it&rsquo;s possible to start from a
compositional evaluation function&#8212;<wbr></wbr>a definitional interpreter&#8212;<wbr></wbr>and
follow a similar sequence of abstraction steps to arrive at a
computable abstraction<span class="Autobibref">&nbsp;(<a href="index.html#%28autobib._.David._.Darais%2C._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Nicholas._.Labich%2C._and._.David._.Van._.Horn.Abstracting._.Definitional._.Interpreters._%28.Functional._.Pearl%29.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292017%29" class="AutobibLink" data-pltdoc="x">Darais et al<span class="Sendabbrev">.</span></a> <a href="index.html#%28autobib._.David._.Darais%2C._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n%2C._.Nicholas._.Labich%2C._and._.David._.Van._.Horn.Abstracting._.Definitional._.Interpreters._%28.Functional._.Pearl%29.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._%28.I.C.F.P%292017%29" class="AutobibLink" data-pltdoc="x">2017</a>)</span>.  This alternative perspective
yields a pushdown model, but do so in a peculiar way: it inherits the
property from the meta-language rather than through an explicit
object-level model of the stack.</p><h3>6<tt>&nbsp;</tt><a name="(part._.Acknowledgments)"></a>Acknowledgments</h3><p>Earlier versions of this tutorial were presented to audiences at the
<a href="http://www.dagstuhl.de/en/program/calendar/semhp/?semnr=14271">Dagstuhl
Seminar on &ldquo;Scripting Languages and Frameworks: Analysis and
Verification&rdquo;</a>, July 2014, the
<a href="https://www.cs.utah.edu/~mflatt/plt-redex/">PLT Redex Summer
School</a> at the University of Utah, July 2015, the University of Chile,
January 2016, and
<a href="http://conf.researchr.org/home/POPL-2016">POPL</a>, January 2016;
I&rsquo;m grateful to the participants for their attention and feedback.  In
particular, I&rsquo;d like to thank Robby Findler, Matthias Felleisen, and
&#201;ric Tanter for helpful comments.  I&rsquo;m grateful to Nada Amin, Michael
Bernstein, Andrew Kent, Ph&#250;c C. Nguy&#7877;n, and Leandro Facchinetti for
pull requests.</p><h3><a name="(part._doc-bibliography)"></a>Bibliography</h3><p><table cellspacing="0" cellpadding="0" class="AutoBibliography"><tr><td><p><a name="(autobib._.Mart~c3~adn._.Abadi,._.Luca._.Cardelli,._.Pierre-.Louis._.Curien,._and._.Jean-.Jacques._.L~c3~a9vy.Explicit._.Substitutions.Journal._of._.Functional._.Programming._1(4),._pp..._375--4161991)"></a><span class="Autobibentry">Mart&#237;n Abadi, Luca Cardelli, Pierre-Louis Curien, and Jean-Jacques L&#233;vy. Explicit Substitutions. <span style="font-style: italic">Journal of Functional Programming</span> 1(4), pp. 375&ndash;416, 1991.</span></p></td></tr><tr><td><p><a name="(autobib._.David._.Darais,._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n,._.Nicholas._.Labich,._and._.David._.Van._.Horn.Abstracting._.Definitional._.Interpreters._(.Functional._.Pearl).In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._(.I.C.F.P)2017)"></a><span class="Autobibentry">David Darais, Ph&#250;c C. Nguy&#7877;n, Nicholas Labich, and David Van Horn. Abstracting Definitional Interpreters (Functional Pearl). In <span style="font-style: italic">Proc. The ACM SIGPLAN International Conference on Functional Programming (ICFP)</span>, 2017.</span></p></td></tr><tr><td><p><a name="(autobib._.David._.Darais._and._.David._.Van._.Horn.Galois._.Transformers._and._.Modular._.Abstract._.Interpreters.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming,._.Systems,._.Languages._and~0a.Applications._(.O.O.P.S.L.A)2015)"></a><span class="Autobibentry">David Darais and David Van Horn. Galois Transformers and Modular Abstract Interpreters. In <span style="font-style: italic">Proc. ACM International Conference on
Object-Oriented Programming, Systems, Languages and
Applications (OOPSLA)</span>, 2015.</span></p></td></tr><tr><td><p><a name="(autobib._.Christopher._.Earl,._.Matthew._.Might,._and._.David._.Van._.Horn.Pushdown._.Control-.Flow._.Analysis._of._.Higher-.Order._.Programs.In._.Proc..._.Workshop._on._.Scheme._and._.Functional~0a.Programming._(.S.F.P)2010)"></a><span class="Autobibentry">Christopher Earl, Matthew Might, and David Van Horn. Pushdown Control-Flow Analysis of Higher-Order Programs. In <span style="font-style: italic">Proc. Workshop on Scheme and Functional
Programming (SFP)</span>, 2010.</span></p></td></tr><tr><td><p><a name="(autobib._.Christopher._.Earl,._.Ilya._.Sergey,._.Matthew._.Might,._and._.David._.Van._.Horn.Introspective._.Pushdown._.Analysis._of._.Higher-.Order._.Programs.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._(.I.C.F.P)2012)"></a><span class="Autobibentry">Christopher Earl, Ilya Sergey, Matthew Might, and David Van Horn. Introspective Pushdown Analysis of Higher-Order Programs. In <span style="font-style: italic">Proc. ACM SIGPLAN International Conference on Functional Programming (ICFP)</span>, 2012.</span></p></td></tr><tr><td><p><a name="(autobib._.Matthias._.Felleisen,._.Robert._.Bruce._.Findler,._and._.Matthew._.Flatt.Semantics._.Engineering._with._.P.L.T._.Redex.M.I.T._.Press2009)"></a><span class="Autobibentry">Matthias Felleisen, Robert Bruce Findler, and Matthew Flatt. Semantics Engineering with PLT Redex. MIT Press, 2009.</span></p></td></tr><tr><td><p><a name="(autobib._.Cormac._.Flanagan._and._.Matthias._.Felleisen.Componential._set-based._analysis.Componential._set-based._analysis._21(2)1999)"></a><span class="Autobibentry">Cormac Flanagan and Matthias Felleisen. Componential set-based analysis. <span style="font-style: italic">Componential set-based analysis</span> 21(2), 1999.</span></p></td></tr><tr><td><p><a name="(autobib._.Thomas._.Gilray,._.Steven._.Lyde,._.Michael._.D..._.Adams,._.Matthew._.Might,._and._.David._.Van._.Horn.Pushdown._.Control-.Flow._.Analysis._for._.Free.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T._.Symposium._on~0a.Principles._in._.Programming._.Languages._(.P.O.P.L)2016)"></a><span class="Autobibentry">Thomas Gilray, Steven Lyde, Michael D. Adams, Matthew Might, and David Van Horn. Pushdown Control-Flow Analysis for Free. In <span style="font-style: italic">Proc. ACM SIGPLAN-SIGACT Symposium on
Principles in Programming Languages (POPL)</span>, 2016.</span></p></td></tr><tr><td><p><a name="(autobib._.J..._.Ian._.Johnson,._.Nicholas._.Labich,._.Matthew._.Might,._and._.David._.Van._.Horn.Optimizing._.Abstract._.Abstract._.Machines.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International~0a.Conference._on._.Functional._.Programming._(.I.C.F.P)2013)"></a><span class="Autobibentry">J. Ian Johnson, Nicholas Labich, Matthew Might, and David Van Horn. Optimizing Abstract Abstract Machines. In <span style="font-style: italic">Proc. ACM SIGPLAN International
Conference on Functional Programming (ICFP)</span>, 2013.</span></p></td></tr><tr><td><p><a name="(autobib._.J..._.Ian._.Johnson,._.Ilya._.Sergey,._.Christopher._.Earl,._.Matthew._.Might,._and._.David._.Van._.Horn.Pushdown._flow._analysis._with._abstract._garbage._collection.Journal._of._.Functional._.Programming._24(2--3)2014)"></a><span class="Autobibentry">J. Ian Johnson, Ilya Sergey, Christopher Earl, Matthew Might, and David Van Horn. Pushdown flow analysis with abstract garbage collection. <span style="font-style: italic">Journal of Functional Programming</span> 24(2&ndash;3), 2014.</span></p></td></tr><tr><td><p><a name="(autobib._.J..._.Ian._.Johnson._and._.David._.Van._.Horn.Abstracting._.Abstract._.Control.In._.Proc..._.A.C.M._.Symposium._on._.Dynamic~0a.Languages._(.D.L.S)2014)"></a><span class="Autobibentry">J. Ian Johnson and David Van Horn. Abstracting Abstract Control. In <span style="font-style: italic">Proc. ACM Symposium on Dynamic
Languages (DLS)</span>, 2014.</span></p></td></tr><tr><td><p><a name="(autobib._.Vineeth._.Kashyap,._.Kyle._.Dewey,._.Ethan._.A..._.Kuefner,._.John._.Wagner,._.Kevin._.Gibbons,._.John._.Sarracino,._.Ben._.Wiedermann,._and._.Ben._.Hardekopf.J.S.A.I~3a._.A._.Static._.Analysis._.Platform._for._.Java.Script.In._.Proc..._.Symposium._on._.Foundations._of._.Software._.Engineering._(.F.S.E)2014)"></a><span class="Autobibentry">Vineeth Kashyap, Kyle Dewey, Ethan A. Kuefner, John Wagner, Kevin Gibbons, John Sarracino, Ben Wiedermann, and Ben Hardekopf. JSAI: A Static Analysis Platform for JavaScript. In <span style="font-style: italic">Proc. Symposium on Foundations of Software Engineering (FSE)</span>, 2014.</span></p></td></tr><tr><td><p><a name="(autobib._.Casey._.Klein,._.John._.Clements,._.Christos._.Dimoulas,._.Carl._.Eastlund,._.Matthias._.Felleisen,._.Matthew._.Flatt,._.Jay._.A..._.Mc.Carthy,._.Jon._.Rafkind,._.Sam._.Tobin-.Hochstadt,._and._.Robert._.Bruce._.Findler.Run._.Your._.Research~3a._.On._the._.Effectiveness._of._.Lightweight._.Mechanization.In._.Proc..._.The._39th._.Annual._.A.C.M._.S.I.G.P.L.A.N-.S.I.G.A.C.T~0a.Symposium._on._.Principles._of._.Programming._.Languages._(.P.O.P.L)2012)"></a><span class="Autobibentry">Casey Klein, John Clements, Christos Dimoulas, Carl Eastlund, Matthias Felleisen, Matthew Flatt, Jay A. McCarthy, Jon Rafkind, Sam Tobin-Hochstadt, and Robert Bruce Findler. Run Your Research: On the Effectiveness of Lightweight Mechanization. In <span style="font-style: italic">Proc. The 39th Annual ACM SIGPLAN-SIGACT
Symposium on Principles of Programming Languages (POPL)</span>, 2012.</span></p></td></tr><tr><td><p><a name="(autobib._.Shuying._.Liang,._.Andrew._.W..._.Keep,._.Matthew._.Might,._.Steven._.Lyde,._.Thomas._.Gilray,._.Petey._.Aldous,._and._.David._.Van._.Horn.Sound._and._.Precise._.Malware._.Analysis._for._.Android._via~0a.Pushdown._.Reachability._and._.Entry-.Point._.Saturation.In._.Proc..._.Third._.A.C.M._workshop._on._.Security~0aand._privacy._in._smartphones._~26._mobile._devices2013)"></a><span class="Autobibentry">Shuying Liang, Andrew W. Keep, Matthew Might, Steven Lyde, Thomas Gilray, Petey Aldous, and David Van Horn. Sound and Precise Malware Analysis for Android via
Pushdown Reachability and Entry-Point Saturation. In <span style="font-style: italic">Proc. Third ACM workshop on Security
and privacy in smartphones &amp; mobile devices</span>, 2013a.</span></p></td></tr><tr><td><p><a name="(autobib._.Shuying._.Liang,._.Matthew._.Might,._and._.David._.Van._.Horn.Ana.Droid~3a._.Malware._.Analysis._of._.Android._with._.User-supplied._.Predicates.In._.Proc..._.Workshop._on._.Tools._for._.Automatic._.Program._.Analysis2013)"></a><span class="Autobibentry">Shuying Liang, Matthew Might, and David Van Horn. AnaDroid: Malware Analysis of Android with User-supplied Predicates. In <span style="font-style: italic">Proc. Workshop on Tools for Automatic Program Analysis</span>, 2013b.</span></p></td></tr><tr><td><p><a name="(autobib._.Matthew._.Might._and._.David._.Van._.Horn.A._.Family._of._.Abstract._.Interpretations._for._.Static._.Analysis~0aof._.Concurrent._.Higher-.Order._.Programs.In._.Proc..._.International._.Static._.Analysis~0a.Symposium._(.S.A.S)2011)"></a><span class="Autobibentry">Matthew Might and David Van Horn. A Family of Abstract Interpretations for Static Analysis
of Concurrent Higher-Order Programs. In <span style="font-style: italic">Proc. International Static Analysis
Symposium (SAS)</span>, 2011.</span></p></td></tr><tr><td><p><a name="(autobib._.Steven._.S..._.Muchnick._and._.Neil._.D..._.Jones.Program._.Flow._.Analysis~3a._.Theory._and._.Applications.Prentice._.Hall1981)"></a><span class="Autobibentry">Steven S. Muchnick and Neil D. Jones. Program Flow Analysis: Theory and Applications. Prentice Hall, 1981.</span></p></td></tr><tr><td><p><a name="(autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n,._.Thomas._.Gilray,._.Sam._.Tobin-.Hochstadt,._and._.David._.Van._.Horn.Soft._.Contract._.Verification._for._.Higher-order._.Stateful._.Programs.In._.Proc..._.The._45th._.A.C.M._.S.I.G.P.L.A.N._.Symposium._on._.Principles._of._.Programming._.Languages._(.P.O.P.L)2018)"></a><span class="Autobibentry">Ph&#250;c C. Nguy&#7877;n, Thomas Gilray, Sam Tobin-Hochstadt, and David Van Horn. Soft Contract Verification for Higher-order Stateful Programs. In <span style="font-style: italic">Proc. The 45th ACM SIGPLAN Symposium on Principles of Programming Languages (POPL)</span>, 2018.</span></p></td></tr><tr><td><p><a name="(autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n,._.Sam._.Tobin-.Hochstadt,._and._.David._.Van._.Horn.Soft._.Contract._.Verification.In._.Proc..._.The._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._(.I.C.F.P)2014)"></a><span class="Autobibentry">Ph&#250;c C. Nguy&#7877;n, Sam Tobin-Hochstadt, and David Van Horn. Soft Contract Verification. In <span style="font-style: italic">Proc. The ACM SIGPLAN International Conference on Functional Programming (ICFP)</span>, 2014.</span></p></td></tr><tr><td><p><a name="(autobib._.Ph~c3~bac._.C..._.Nguy~e1~bb~85n._and._.David._.Van._.Horn.Relatively._.Complete._.Counterexamples._for._.Higher-.Order._.Programs.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.Conference._on._.Programming._.Language._.Design._and._.Implementation._(.P.L.D.I)2015)"></a><span class="Autobibentry">Ph&#250;c C. Nguy&#7877;n and David Van Horn. Relatively Complete Counterexamples for Higher-Order Programs. In <span style="font-style: italic">Proc. ACM SIGPLAN Conference on Programming Language Design and Implementation (PLDI)</span>, 2015.</span></p></td></tr><tr><td><p><a name="(autobib._.Gordon._.Plotkin.L.C.F._considered._as._a._programming._language.Theoretical._.Computer._.Science._5,._pp..._223--2551977http~3a//homepages..inf..ed..ac..uk/gdp/publications/.L.C.F..pdf)"></a><span class="Autobibentry">Gordon Plotkin. LCF considered as a programming language. <span style="font-style: italic">Theoretical Computer Science</span> 5, pp. 223&ndash;255, 1977. <a href="http://homepages.inf.ed.ac.uk/gdp/publications/LCF.pdf"><span class="url">http://homepages.inf.ed.ac.uk/gdp/publications/LCF.pdf</span></a></span></p></td></tr><tr><td><p><a name="(autobib._.Ilya._.Sergey,._.Dominique._.Devriese,._.Matthew._.Might,._.Jan._.Midtgaard,._.David._.Darais,._.Dave._.Clarke,._and._.Frank._.Piessens.Monadic._.Abstract._.Interpreters.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.Conference._on~0a.Programming._.Language._.Design._and._.Implementation._(.P.L.D.I)2013)"></a><span class="Autobibentry">Ilya Sergey, Dominique Devriese, Matthew Might, Jan Midtgaard, David Darais, Dave Clarke, and Frank Piessens. Monadic Abstract Interpreters. In <span style="font-style: italic">Proc. ACM SIGPLAN Conference on
Programming Language Design and Implementation (PLDI)</span>, 2013.</span></p></td></tr><tr><td><p><a name="(autobib._.Olin._.Shivers.Control-.Flow._.Analysis._of._.Higher-.Order._.Languages.Ph.D._dissertation,._.Carnegie._.Mellon._.University1991)"></a><span class="Autobibentry">Olin Shivers. Control-Flow Analysis of Higher-Order Languages. PhD dissertation, Carnegie Mellon University, 1991.</span></p></td></tr><tr><td><p><a name="(autobib._.Asumu._.Takikawa,._.T..._.Stephen._.Strickland,._.Christos._.Dimoulas,._.Sam._.Tobin-.Hochstadt,._and._.Matthias._.Felleisen.Gradual._.Typing._for._.First-.Class._.Classes.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming,._.Systems,._.Languages._and~0a.Applications._(.O.O.P.S.L.A)2012)"></a><span class="Autobibentry">Asumu Takikawa, T. Stephen Strickland, Christos Dimoulas, Sam Tobin-Hochstadt, and Matthias Felleisen. Gradual Typing for First-Class Classes. In <span style="font-style: italic">Proc. ACM International Conference on
Object-Oriented Programming, Systems, Languages and
Applications (OOPSLA)</span>, 2012.</span></p></td></tr><tr><td><p><a name="(autobib._.Asumu._.Takikawa,._.T..._.Stephen._.Strickland,._and._.Sam._.Tobin-.Hochstadt.Constraining._.Delimited._.Control._with._.Contracts.In._.Proc..._.European._.Symposium._on._.Programming._(.E.S.O.P)2013)"></a><span class="Autobibentry">Asumu Takikawa, T. Stephen Strickland, and Sam Tobin-Hochstadt. Constraining Delimited Control with Contracts. In <span style="font-style: italic">Proc. European Symposium on Programming (ESOP)</span>, 2013.</span></p></td></tr><tr><td><p><a name="(autobib._.Sam._.Tobin-.Hochstadt._and._.David._.Van._.Horn.Higher-.Order._.Symbolic._.Execution._with._.Contracts.In._.Proc..._.A.C.M._.International._.Conference._on~0a.Object-.Oriented._.Programming,._.Systems,._.Languages._and~0a.Applications._(.O.O.P.S.L.A)2012)"></a><span class="Autobibentry">Sam Tobin-Hochstadt and David Van Horn. Higher-Order Symbolic Execution with Contracts. In <span style="font-style: italic">Proc. ACM International Conference on
Object-Oriented Programming, Systems, Languages and
Applications (OOPSLA)</span>, 2012.</span></p></td></tr><tr><td><p><a name="(autobib._.David._.Van._.Horn._and._.Matthew._.Might.Abstracting._.Abstract._.Machines.In._.Proc..._.The._15th._.A.C.M._.S.I.G.P.L.A.N._.International._.Conference._on._.Functional._.Programming._(.I.C.F.P)2010)"></a><span class="Autobibentry">David Van Horn and Matthew Might. Abstracting Abstract Machines. In <span style="font-style: italic">Proc. The 15th ACM SIGPLAN International Conference on Functional Programming (ICFP)</span>, 2010.</span></p></td></tr><tr><td><p><a name="(autobib._.David._.Van._.Horn._and._.Matthew._.Might.Pushdown._.Abstractions._of._.Java.Scriptar.Xiv,._109-44672011)"></a><span class="Autobibentry">David Van Horn and Matthew Might. Pushdown Abstractions of JavaScript. arXiv, 109-4467, 2011.</span></p></td></tr><tr><td><p><a name="(autobib._.David._.Van._.Horn._and._.Matthew._.Might.Systematic._.Abstraction._of._.Abstract._.Machines.Journal._of._.Functional._.Programming._22(4-5)2012)"></a><span class="Autobibentry">David Van Horn and Matthew Might. Systematic Abstraction of Abstract Machines. <span style="font-style: italic">Journal of Functional Programming</span> 22(4-5), 2012.</span></p></td></tr><tr><td><p><a name="(autobib._.Dimitris._.Vardoulakis._and._.Olin._.Shivers.C.F.A2~3a._a._.Context-.Free._.Approach._to._.Control-.Flow._.Analysis.Logical._.Methods._in._.Computer._.Science._7(2-3)2011)"></a><span class="Autobibentry">Dimitris Vardoulakis and Olin Shivers. CFA2: a Context-Free Approach to Control-Flow Analysis. <span style="font-style: italic">Logical Methods in Computer Science</span> 7(2-3), 2011a.</span></p></td></tr><tr><td><p><a name="(autobib._.Dimitris._.Vardoulakis._and._.Olin._.Shivers.Pushdown._.Flow._.Analysis._of._.First-.Class._.Control.In._.Proc..._.A.C.M._.S.I.G.P.L.A.N._.International~0a.Conference._on._.Functional._.Programming._(.I.C.F.P)2011)"></a><span class="Autobibentry">Dimitris Vardoulakis and Olin Shivers. Pushdown Flow Analysis of First-Class Control. In <span style="font-style: italic">Proc. ACM SIGPLAN International
Conference on Functional Programming (ICFP)</span>, 2011b.</span></p></td></tr></table></p><h3>7<tt>&nbsp;</tt><a name="(part._.Appendix__.Substitution)"></a>Appendix: Substitution</h3><blockquote class="SCodeFlow"><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-language%29%29" class="RktStxLink" data-pltdoc="x">define-language</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">T</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">any</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">variable-except</span><span class="hspace">&nbsp;</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktSym">if0</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">num</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">1. X_1 bound, so don't continue in &#955; body</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_2</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">X_3</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_3</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_2</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_1</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktPn">[</span><span class="RktSym">X_3</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_3</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">side-condition</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/booleans.html#%28def._%28%28quote._~23~25kernel%29._not%29%29" class="RktValLink" data-pltdoc="x">not</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/reference/pairs.html#%28def._%28%28lib._racket%2Fprivate%2Fbase..rkt%29._member%29%29" class="RktValLink" data-pltdoc="x">member</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">or &#956;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">2. general purpose capture avoiding case </span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_2</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#955;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">[</span><span class="RktSym">X_new</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T_2</span><span class="RktPn">]</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">X_new</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_new</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._variables-not-in%29%29" class="RktValLink" data-pltdoc="x">variables-not-in</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">and &#956;</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">&#956;</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_new</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktSym">T</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">X_new</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">where</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_new</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktRdr">,</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28def._%28%28lib._redex%2Freduction-semantics..rkt%29._variables-not-in%29%29" class="RktValLink" data-pltdoc="x">variables-not-in</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._term%29%29" class="RktStxLink" data-pltdoc="x">term</a></span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">3. replace X_1 with M_1</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">4. X_1 and X_2 are different, so don't replace</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">X_2</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktCmt">;</span><span class="RktCmt">&nbsp;</span><span class="RktCmt">the last cases cover all other expressions</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_2</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-1</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr><tr><td><table cellspacing="0" cellpadding="0" class="RktBlk"><tr><td><span class="stt">&gt; </span><span class="RktPn">(</span><span class="RktSym"><a href="http://docs.racket-lang.org/redex/The_Redex_Reference.html#%28form._%28%28lib._redex%2Freduction-semantics..rkt%29._define-metafunction%29%29" class="RktStxLink" data-pltdoc="x">define-metafunction</a></span><span class="hspace">&nbsp;</span><span class="RktSym">L</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktSym">:</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="hspace">&nbsp;</span><span class="RktSym"><span class="nobreak">-&gt;</span></span><span class="hspace">&nbsp;</span><span class="RktSym">M</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">X_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">M_2</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">)</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_1</span><span class="hspace">&nbsp;</span><span class="RktSym">M_1</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym">X_2</span><span class="hspace">&nbsp;</span><span class="RktSym">M_2</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">...</span><span class="hspace">&nbsp;</span><span class="RktSym">M_3</span><span class="RktPn">)</span><span class="RktPn">)</span><span class="RktPn">]</span></td></tr><tr><td><span class="hspace">&nbsp;&nbsp;</span><span class="hspace">&nbsp;&nbsp;</span><span class="RktPn">[</span><span class="RktPn">(</span><span class="RktSym">subst-vars</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">)</span><span class="hspace">&nbsp;</span><span class="RktSym">M</span><span class="RktPn">]</span><span class="RktPn">)</span></td></tr></table></td></tr></table></blockquote></div></div><div id="contextindicator">&nbsp;</div></body></html>